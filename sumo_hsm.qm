<?xml version="1.0" encoding="UTF-8"?>
<model version="5.2.2" links="1">
 <!--${qpc}-->
 <framework name="qpc"/>
 <!--${AOs}-->
 <package name="AOs" stereotype="0x02">
  <!--${AOs::SumoHSM_ctor}-->
  <operation name="SumoHSM_ctor" type="void" visibility="0x00" properties="0x01">
   <documentation>The Blinky &quot;constructor&quot; is provided outside of the Blinky class, so that it can be used independently from the class. This is part of the &quot;opaque pointer&quot; design idiom.</documentation>
   <code>SumoHSM *me = (SumoHSM *)AO_SumoHSM;
QMActive_ctor(&amp;me-&gt;super, Q_STATE_CAST(&amp;SumoHSM_initial));
QTimeEvt_ctorX(&amp;me-&gt;timeEvt, &amp;me-&gt;super.super, TIMEOUT_SIG, 0U);
QTimeEvt_ctorX(&amp;me-&gt;timeEvt_2, &amp;me-&gt;super.super, TIMEOUT_2_SIG, 0U);
QTimeEvt_ctorX(&amp;me-&gt;timeEvtBle, &amp;me-&gt;super.super, TIMEOUT_SEND_BLE_SIG, 0U);
QTimeEvt_ctorX(&amp;me-&gt;buzzerStopTimer, &amp;me-&gt;super.super, STOP_BUZZER_SIG, 0U);
QTimeEvt_ctorX(&amp;me-&gt;timerFailSafe, &amp;me-&gt;super.super, FAILSAFE_SIG, 0U);
QTimeEvt_ctorX(&amp;me-&gt;timeEvtStuck, &amp;me-&gt;super.super, STUCK_SIG, 0U);
QTimeEvt_ctorX(&amp;me-&gt;timeEvtStuckEnd, &amp;me-&gt;super.super, STUCK_END_SIG, 0U);
me-&gt;ble_counter = 0;
me-&gt;stuck_counter = 0;
me-&gt;step_counter = 0;</code>
  </operation>
  <!--${AOs::SumoHSM}-->
  <class name="SumoHSM" superclass="qpc::QMActive">
   <!--${AOs::SumoHSM::timeEvt}-->
   <attribute name="timeEvt" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::timeEvt_2}-->
   <attribute name="timeEvt_2" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::timeEvtBle}-->
   <attribute name="timeEvtBle" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::timerFailSafe}-->
   <attribute name="timerFailSafe" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::buzzerStopTimer}-->
   <attribute name="buzzerStopTimer" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::timeEvtStuck}-->
   <attribute name="timeEvtStuck" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::timeEvtStuckEnd}-->
   <attribute name="timeEvtStuckEnd" type="QTimeEvt" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::buzzerCount}-->
   <attribute name="buzzerCount" type="uint8_t" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::ble_counter}-->
   <attribute name="ble_counter" type="uint8_t" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::stuck_counter}-->
   <attribute name="stuck_counter" type="uint8_t" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::step_counter}-->
   <attribute name="step_counter" type="uint8_t" visibility="0x02" properties="0x00"/>
   <!--${AOs::SumoHSM::CheckDistAndMove}-->
   <operation name="CheckDistAndMove" type="uint8_t" visibility="0x02" properties="0x00">
    <code>(void)me;
if (distance_is_active(DIST_SENSOR_F)){
    drive(100,100);
} else if (distance_is_active(DIST_SENSOR_FR) &amp;&amp; distance_is_active(DIST_SENSOR_FL)){
    drive(100,100);
} else if (distance_is_active(DIST_SENSOR_FR)) {
    drive(20,-20);
} else if (distance_is_active(DIST_SENSOR_FL)) {
    drive(-20,20);
} else if (distance_is_active(DIST_SENSOR_DR)) {
    drive(40,-40);
} else if (distance_is_active(DIST_SENSOR_DL)) {
    drive(-40,40);
} else if (distance_is_active(DIST_SENSOR_R)) {
    drive(80,-80);
} else if (distance_is_active(DIST_SENSOR_L)) {
    drive(-80,80);
} else {
   return false;
}
return true;</code>
   </operation>
   <!--${AOs::SumoHSM::CheckDistAndMoveDefense}-->
   <operation name="CheckDistAndMoveDefense" type="uint8_t" visibility="0x02" properties="0x00">
    <code>(void)me;
if (distance_is_active(DIST_SENSOR_F)&amp;&amp;
    distance_is_active(DIST_SENSOR_FR) &amp;&amp; distance_is_active(DIST_SENSOR_FL)){
    drive(100,100);
} else if (distance_is_active(DIST_SENSOR_FR) &amp;&amp; distance_is_active(DIST_SENSOR_FL)){
    drive(0,0);
    return false;
} else if (distance_is_active(DIST_SENSOR_FR)) {
    drive(20,-20);
} else if (distance_is_active(DIST_SENSOR_FL)) {
    drive(-20,20);
} else if (distance_is_active(DIST_SENSOR_DR)) {
    drive(40,-40);
} else if (distance_is_active(DIST_SENSOR_DL)) {
    drive(-40,40);
} else if (distance_is_active(DIST_SENSOR_R)) {
    drive(80,-80);
} else if (distance_is_active(DIST_SENSOR_L)) {
    drive(-80,80);
} else {
    return false;
}
return true;</code>
   </operation>
   <!--${AOs::SumoHSM::UpdateCustomStrategy}-->
   <operation name="UpdateCustomStrategy" type="void" visibility="0x02" properties="0x00">
    <code>uint8_t current_step = cust_strategy_current_step();
if (current_step &gt;= cust_strategy_num_steps()){
    QEvt evt = { .sig = EXIT_CUSTOM_SIG };
    QHSM_DISPATCH(&amp;AO_SumoHSM-&gt;super, &amp;evt, SIMULATOR);
} else {
    movement_t step_type = cust_strategy_move_type(current_step);
    uint16_t movement_parameter = cust_strategy_move(current_step);

    switch (step_type) {
        case MOVE_FRONT:{
            imu_set_setpoint(imu_get_setpoint());
            imu_set_base_speed(100);
            if (movement_parameter &gt; 0){
                uint16_t movement_delay_ms = get_time_to_move_ms(movement_parameter, 100, &amp;parameters);
                QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * movement_delay_ms);
            } else {
                QEvt evt = { .sig = EXIT_CUSTOM_SIG };
                QHSM_DISPATCH(&amp;AO_SumoHSM-&gt;super, &amp;evt, SIMULATOR);
            }
            break;
        }
        case MOVE_BACK: {
            imu_set_setpoint(imu_get_setpoint());
            imu_set_base_speed(-100);
            if (movement_parameter &gt; 0){
                uint16_t movement_delay_ms = get_time_to_move_ms(movement_parameter, 100, &amp;parameters);
                QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * movement_delay_ms);
            } else {
                QEvt evt = { .sig = EXIT_CUSTOM_SIG };
                QHSM_DISPATCH(&amp;AO_SumoHSM-&gt;super, &amp;evt, SIMULATOR);
            }
            break;
        }
        case MOVE_TURN:
            imu_set_setpoint(movement_parameter);
            imu_set_base_speed(0);
            break;
        default: {
            QEvt evt = { .sig = EXIT_CUSTOM_SIG };
            QHSM_DISPATCH(&amp;AO_SumoHSM-&gt;super, &amp;evt, SIMULATOR);
            break;
        }
    }
}
</code>
   </operation>
   <!--${AOs::SumoHSM::SM}-->
   <statechart properties="0x03">
    <!--${AOs::SumoHSM::SM::initial}-->
    <initial target="../1">
     <action>(void)par;

QTimeEvt_armX(&amp;me-&gt;timeEvt_2, BSP_TICKS_PER_MILISSEC * 10, 0);
me-&gt;buzzerCount = 0U;</action>
     <initial_glyph conn="95,2,5,1,-2,11,-9">
      <action box="0,-2,7,2"/>
     </initial_glyph>
    </initial>
    <!--${AOs::SumoHSM::SM::Idle}-->
    <state name="Idle">
     <entry brief="entry">if (parameters.current_state == AUTO_RUNNING || parameters.current_state == RC_RUNNING){
    parameters.current_state = STATE_IDLE;
}

board_led_off();
driving_disable();
drive(0,0);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 500);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;buzzerStopTimer);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
buzzer_stop();

// Buzzer was not finished so  there are missing initializations
if (me-&gt;buzzerCount &lt;= 16){
    me-&gt;buzzerCount = 17;
    bsp_ble_start();
    adc_service_start_callback();
}</exit>
     <!--${AOs::SumoHSM::SM::Idle::TIMEOUT}-->
     <tran trig="TIMEOUT">
      <action brief="board_toggle_led()">board_led_toggle();
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 500);</action>
      <tran_glyph conn="41,16,3,-1,18">
       <action box="0,-2,23,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::Idle::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../3">
      <tran_glyph conn="41,43,3,3,-12,12,6">
       <action box="-16,-3,18,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::Idle::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop()">buzzer_stop();</action>
      <tran_glyph conn="41,24,3,-1,18">
       <action box="0,-2,26,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::Idle::BLE_DATA_UPDATE}-->
     <tran trig="BLE_DATA_UPDATE">
      <action>ble_rcv_packet_t last_data;
ble_service_last_packet(&amp;last_data);
param_error_t stat = parameters_update_from_ble(&amp;parameters, last_data.data);
if (stat == PARAM_OK){
    buzzer_start();
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 200);
}</action>
      <tran_glyph conn="41,35,3,-1,18">
       <action box="0,-2,21,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::Idle::BLE_DATA_REQUEST}-->
     <tran trig="BLE_DATA_REQUEST" target="../../11">
      <tran_glyph conn="41,38,3,2,-14,-26">
       <action box="0,-2,18,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::Idle::TIMEOUT_2}-->
     <tran trig="TIMEOUT_2">
      <action brief="led_stripe_and_beep()">buzzer_start();

if (me-&gt;buzzerCount &lt; 15){
    led_stripe_set_color(me-&gt;buzzerCount, COLOR_PURPLE);
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 42);
    QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, BSP_TICKS_PER_MILISSEC * 84);
} else if (me-&gt;buzzerCount == 15) {
    led_stripe_set_color(me-&gt;buzzerCount, COLOR_PURPLE);
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 42);
    QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, BSP_TICKS_PER_MILISSEC * 200);
    adc_service_start_callback();
} else {
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 600);
    bsp_ble_start();
    start_module_enable();
    if (adc_get_low_pwr_bat()){
        led_stripe_set_all_color(COLOR_RED);
    } else if (adc_get_low_ctrl_bat()){
        led_stripe_set_all_color(COLOR_ORANGE);
    }
}
me-&gt;buzzerCount += 1;</action>
      <tran_glyph conn="41,27,3,-1,18">
       <action box="0,-2,32,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="41,1,43,43">
      <entry box="1,2,24,6"/>
      <exit box="1,8,38,4"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::RCWait}-->
    <state name="RCWait">
     <entry>board_led_off();
parameters_set_strategy_led(&amp;parameters);
parameters_set_pre_strategy_led(&amp;parameters);
drive(0,0);
driving_disable();
parameters.attack_when_near = false;
radio_service_en_radio_data_sig(true);
QTimeEvt_armX(&amp;me-&gt;timeEvt, BSP_TICKS_PER_SEC/10, BSP_TICKS_PER_SEC/10);
ble_service_send_string(&quot;state:RC&quot;);
set_reference_voltage();
me-&gt;step_counter = 0;


QEvt evt_restart_imu = { .sig = IMU_RESTART_SIG };
QHSM_DISPATCH(&amp;imu_service_AO-&gt;super, &amp;evt_restart_imu, SIMULATOR);</entry>
     <exit brief="StopTimer">QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
     <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA}-->
     <tran trig="RADIO_DATA">
      <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30]}-->
      <choice>
       <guard brief="|ch1| or |ch2|&gt; 30">(abs(radio_service_get_channel(RADIO_CH1)) &gt; 30) || (abs(radio_service_get_channel(RADIO_CH2)) &gt; 30)</guard>
       <action brief="en_motors()">driving_enable();
BSP_eeprom_write(EE_CURRENT_STATE_ADDR, RC_RUNNING);</action>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[0]}-->
       <choice target="../../../../10" cpref="../../../../41/0">
        <guard brief="0">parameters.pre_strategy == 0</guard>
        <choice_glyph conn="125,89,4,0,10">
         <action box="1,-3,6,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[1]}-->
       <choice target="../../../../10" cpref="../../../../41/1">
        <guard brief="1">parameters.pre_strategy == 1</guard>
        <choice_glyph conn="125,89,5,0,2,10">
         <action box="4,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[2]}-->
       <choice target="../../../../10" cpref="../../../../41/2">
        <guard brief="2">parameters.pre_strategy == 2</guard>
        <choice_glyph conn="125,89,5,0,4,10">
         <action box="8,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[3]}-->
       <choice target="../../../../10" cpref="../../../../41/3">
        <guard brief="3">parameters.pre_strategy == 3</guard>
        <choice_glyph conn="125,89,5,0,6,10">
         <action box="12,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[4]}-->
       <choice target="../../../../10" cpref="../../../../41/4">
        <guard brief="4">parameters.pre_strategy == 4</guard>
        <choice_glyph conn="125,89,5,0,8,10">
         <action box="16,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[5]}-->
       <choice target="../../../../10" cpref="../../../../41/5">
        <guard brief="5">parameters.pre_strategy == 5</guard>
        <choice_glyph conn="125,89,5,0,10,10">
         <action box="19,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[6]}-->
       <choice target="../../../../10" cpref="../../../../41/6">
        <guard brief="6">parameters.pre_strategy == 6</guard>
        <choice_glyph conn="125,89,5,0,13,10">
         <action box="22,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[7]}-->
       <choice target="../../../../10" cpref="../../../../41/7">
        <guard brief="7">parameters.pre_strategy == 7</guard>
        <choice_glyph conn="125,89,5,0,15,10">
         <action box="25,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[8]}-->
       <choice target="../../../../10" cpref="../../../../41/9">
        <guard brief="8">parameters.pre_strategy == 8</guard>
        <choice_glyph conn="125,89,5,0,17,10">
         <action box="28,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[9]}-->
       <choice target="../../../../10" cpref="../../../../41/10">
        <guard brief="9">parameters.pre_strategy == 9</guard>
        <choice_glyph conn="125,89,5,0,19,10">
         <action box="32,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[10]}-->
       <choice target="../../../../10" cpref="../../../../41/8">
        <guard brief="10">parameters.pre_strategy == 10</guard>
        <choice_glyph conn="125,89,5,0,21,10">
         <action box="36,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[11]}-->
       <choice target="../../../../10" cpref="../../../../41/11">
        <guard brief="11">parameters.pre_strategy == 11</guard>
        <choice_glyph conn="125,89,5,0,24,10">
         <action box="40,-3,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[12]}-->
       <choice target="../../../../10" cpref="../../../../41/12">
        <guard brief="12">parameters.pre_strategy == 12</guard>
        <choice_glyph conn="125,89,5,0,26,10">
         <action box="26,1,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[13]}-->
       <choice target="../../../../10" cpref="../../../../41/13">
        <guard brief="13">parameters.pre_strategy == 13</guard>
        <choice_glyph conn="125,89,5,0,27,10">
         <action box="30,3,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[14]}-->
       <choice target="../../../../10" cpref="../../../../41/14">
        <guard brief="14">parameters.pre_strategy == 14</guard>
        <choice_glyph conn="125,89,5,0,29,10">
         <action box="30,1,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[15]}-->
       <choice target="../../../../10" cpref="../../../../41/15">
        <guard brief="15">parameters.pre_strategy == 15</guard>
        <choice_glyph conn="125,89,5,0,31,10">
         <action box="33,1,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[16]}-->
       <choice target="../../../../10" cpref="../../../../41/16">
        <guard brief="16">parameters.pre_strategy == 16</guard>
        <choice_glyph conn="125,89,5,0,33,10">
         <action box="37,0,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[17]}-->
       <choice target="../../../../10" cpref="../../../../41/17">
        <guard brief="17">parameters.pre_strategy == 17</guard>
        <choice_glyph conn="125,89,5,0,35,10">
         <action box="41,0,4,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[18]}-->
       <choice target="../../../../10" cpref="../../../../41/18">
        <guard brief="18">parameters.pre_strategy == 18</guard>
        <choice_glyph conn="125,89,5,0,38,10">
         <action box="41,3,5,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::RCWait::RADIO_DATA::[|ch1|or|ch2|>30~::[19]}-->
       <choice target="../../../../10" cpref="../../../../41/19">
        <guard brief="19">parameters.pre_strategy == 19</guard>
        <choice_glyph conn="125,89,5,0,41,10">
         <action box="41,6,4,3"/>
        </choice_glyph>
       </choice>
       <choice_glyph conn="125,82,4,-1,7">
        <action box="-13,0,16,6"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="133,77,3,-1,-8,5">
       <action box="-11,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../5">
      <action>parameters.attack_when_near = false;</action>
      <tran_glyph conn="164,50,1,3,83,-13,2">
       <action box="0,-2,32,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::TIMEOUT}-->
     <tran trig="TIMEOUT">
      <action>board_led_toggle();</action>
      <tran_glyph conn="133,48,3,-1,17">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::CHANGE_STRATEGY_EVT}-->
     <tran trig="CHANGE_STRATEGY_EVT">
      <action brief="Update Strategy">parameters_set_strategy(&amp;parameters, (parameters.strategy + 1));
parameters_set_strategy_led(&amp;parameters);</action>
      <tran_glyph conn="133,59,3,-1,19">
       <action box="0,-2,23,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::CHANGE_PRE_STRATEGY_EVT}-->
     <tran trig="CHANGE_PRE_STRATEGY_EVT">
      <action brief="Update PreStrategy">parameters_update_pre_strategy(&amp;parameters, (parameters.pre_strategy + 1));
parameters_set_pre_strategy_led(&amp;parameters);
set_reference_voltage();</action>
      <tran_glyph conn="133,54,3,-1,18">
       <action box="0,-2,26,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::BLE_DATA_REQUEST}-->
     <tran trig="BLE_DATA_REQUEST" target="../../13">
      <tran_glyph conn="164,32,1,1,17,-19,-18">
       <action box="0,-3,18,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::BLE_DATA_UPDATE}-->
     <tran trig="BLE_DATA_UPDATE">
      <action>ble_rcv_packet_t last_data;
ble_service_last_packet(&amp;last_data);
param_error_t stat = parameters_update_from_ble(&amp;parameters, last_data.data);
if (stat == PARAM_OK){
    buzzer_start();
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 200);
}</action>
      <tran_glyph conn="133,51,3,-1,17">
       <action box="0,-2,18,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::LINE_CHANGED_BL, LINE_CHANGED_BR~}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR, LINE_CHANGED_FL, LINE_CHANGED_FR">
      <action brief="buzzer_on">if (adc_line_none_white()){
    buzzer_stop();
} else {
    buzzer_start();
}

parameters_report(parameters, 2);</action>
      <tran_glyph conn="133,44,5,-1,16">
       <action box="0,-2,23,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop">buzzer_stop();</action>
      <tran_glyph conn="133,40,3,-1,15">
       <action box="0,-2,17,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::DIST_SENSOR_CHANGE}-->
     <tran trig="DIST_SENSOR_CHANGE">
      <action>parameters_report(parameters, 2);</action>
      <!--${AOs::SumoHSM::SM::RCWait::DIST_SENSOR_CHAN~::[attack_when_near]}-->
      <choice target="../../../21">
       <guard brief="attack_when_near">parameters.attack_when_near &amp;&amp; (distance_is_active(DIST_SENSOR_F) || distance_is_active(DIST_SENSOR_DR) || distance_is_active(DIST_SENSOR_DL))</guard>
       <action brief="driving_enable();">driving_enable();
BSP_eeprom_write(EE_CURRENT_STATE_ADDR, RC_RUNNING);</action>
       <choice_glyph conn="109,72,4,0,22">
        <action box="-4,-5,17,5"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="133,72,3,-1,-24">
       <action box="0,-2,22,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RCWait::BLE_ATTACK_NEAR}-->
     <tran trig="BLE_ATTACK_NEAR">
      <action>parameters.attack_when_near = !parameters.attack_when_near;
if (parameters.attack_when_near){
    led_stripe_set_all_color(COLOR_RED);
    buzzer_start();
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 1000);
} else {
    led_stripe_set_all_color(COLOR_BLACK);
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 1000);
    buzzer_start();
}</action>
      <tran_glyph conn="133,66,3,-1,15">
       <action box="0,-2,15,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="133,25,31,56">
      <entry box="1,2,14,4"/>
      <exit box="1,6,14,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::AutoWait}-->
    <state name="AutoWait">
     <entry>drive(0,0);
driving_disable();
board_led_on();
ble_service_send_string(&quot;state:AUTO&quot;);
parameters_set_strategy_led(&amp;parameters);
parameters_set_pre_strategy_led(&amp;parameters);
radio_service_en_radio_data_sig(false);
me-&gt;stuck_counter = 0;
me-&gt;step_counter = 0;
parameters.attack_when_near = false;
start_module_enable();
set_reference_voltage();

QEvt evt_restart_imu = { .sig = IMU_RESTART_SIG };
QHSM_DISPATCH(&amp;imu_service_AO-&gt;super, &amp;evt_restart_imu, SIMULATOR);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
     <!--${AOs::SumoHSM::SM::AutoWait::START}-->
     <tran trig="START">
      <action>driving_enable();
radio_service_disable();
BSP_eeprom_write(EE_CURRENT_STATE_ADDR, AUTO_RUNNING);</action>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_0]}-->
      <choice target="../../../8" cpref="../../../41/0">
       <guard brief="ps_0">parameters.pre_strategy == 0</guard>
       <choice_glyph conn="52,107,5,0,-27,6">
        <action box="-29,-3,6,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_1]}-->
      <choice target="../../../8" cpref="../../../41/1">
       <guard brief="ps_1">parameters.pre_strategy == 1</guard>
       <choice_glyph conn="52,107,5,0,-25,6">
        <action box="-23,-3,7,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_2]}-->
      <choice target="../../../8" cpref="../../../41/2">
       <guard brief="ps_2">parameters.pre_strategy == 2</guard>
       <choice_glyph conn="52,107,5,0,-22,6">
        <action box="-18,-3,7,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_3]}-->
      <choice target="../../../8" cpref="../../../41/3">
       <guard brief="ps_3">parameters.pre_strategy == 3</guard>
       <choice_glyph conn="52,107,5,0,-19,6">
        <action box="-12,-3,6,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_4]}-->
      <choice target="../../../8" cpref="../../../41/4">
       <guard brief="ps_4">parameters.pre_strategy == 4</guard>
       <choice_glyph conn="52,107,5,0,-16,6">
        <action box="-6,-3,5,3"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_5]}-->
      <choice target="../../../8" cpref="../../../41/5">
       <guard brief="ps_5">parameters.pre_strategy == 5</guard>
       <choice_glyph conn="52,107,5,0,-14,6">
        <action box="0,-3,5,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_6]}-->
      <choice target="../../../8" cpref="../../../41/6">
       <guard brief="ps_6">parameters.pre_strategy == 6</guard>
       <choice_glyph conn="52,107,5,0,-11,6">
        <action box="5,-3,6,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_7]}-->
      <choice target="../../../8" cpref="../../../41/7">
       <guard brief="ps_7">parameters.pre_strategy == 7</guard>
       <choice_glyph conn="52,107,5,0,-8,6">
        <action box="10,-3,6,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_8]}-->
      <choice target="../../../8" cpref="../../../41/9">
       <guard brief="ps_8">parameters.pre_strategy == 8</guard>
       <choice_glyph conn="52,107,5,0,-6,6">
        <action box="15,-3,6,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_9]}-->
      <choice target="../../../8" cpref="../../../41/10">
       <guard brief="ps_9">parameters.pre_strategy == 9</guard>
       <choice_glyph conn="52,107,4,0,4,-3,2">
        <action box="20,-3,10,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_10]}-->
      <choice target="../../../8" cpref="../../../41/8">
       <guard brief="ps_10">parameters.pre_strategy == 10</guard>
       <choice_glyph conn="52,107,4,0,6">
        <action box="25,-3,7,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[ps_11]}-->
      <choice target="../../../8" cpref="../../../41/11">
       <guard brief="ps_11">parameters.pre_strategy == 11</guard>
       <choice_glyph conn="52,107,5,0,3,6">
        <action box="31,-3,7,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[12]}-->
      <choice target="../../../8" cpref="../../../41/12">
       <guard brief="12">parameters.pre_strategy == 12</guard>
       <choice_glyph conn="52,107,5,0,5,6">
        <action box="6,0,4,3"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[13]}-->
      <choice target="../../../8" cpref="../../../41/13">
       <guard brief="13">parameters.pre_strategy == 13</guard>
       <choice_glyph conn="52,107,5,0,7,6">
        <action box="9,0,10,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[14]}-->
      <choice target="../../../8" cpref="../../../41/14">
       <guard brief="14">parameters.pre_strategy == 14</guard>
       <choice_glyph conn="52,107,5,0,9,6">
        <action box="14,0,4,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[15]}-->
      <choice target="../../../8" cpref="../../../41/15">
       <guard brief="15">parameters.pre_strategy == 15</guard>
       <choice_glyph conn="52,107,5,0,12,6">
        <action box="18,0,4,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[16]}-->
      <choice target="../../../8" cpref="../../../41/16">
       <guard brief="16">parameters.pre_strategy == 16</guard>
       <choice_glyph conn="52,107,5,0,15,6">
        <action box="21,0,4,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[17]}-->
      <choice target="../../../8" cpref="../../../41/17">
       <guard brief="17">parameters.pre_strategy == 17</guard>
       <choice_glyph conn="52,107,5,0,17,6">
        <action box="24,0,4,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[18]}-->
      <choice target="../../../8" cpref="../../../41/18">
       <guard brief="18">parameters.pre_strategy == 18</guard>
       <choice_glyph conn="52,107,5,0,20,6">
        <action box="24,2,4,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::AutoWait::START::[19]}-->
      <choice target="../../../8" cpref="../../../41/19">
       <guard brief="19">parameters.pre_strategy == 19</guard>
       <choice_glyph conn="52,107,5,0,24,6">
        <action box="27,2,4,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="35,99,3,-1,17,8">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../2">
      <action>start_module_disable();</action>
      <tran_glyph conn="71,58,1,3,31,-11,31">
       <action box="0,-2,22,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::CHANGE_STRATEGY_EVT}-->
     <tran trig="CHANGE_STRATEGY_EVT">
      <action brief="change_strategy">parameters_set_strategy(&amp;parameters, (parameters.strategy + 1));
parameters_set_strategy_led(&amp;parameters);</action>
      <tran_glyph conn="35,65,3,-1,11">
       <action box="0,-3,29,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::CHANGE_PRE_STRATEGY_EVT}-->
     <tran trig="CHANGE_PRE_STRATEGY_EVT">
      <action brief="change_pre_strategy">parameters_update_pre_strategy(&amp;parameters, (parameters.pre_strategy + 1));
parameters_set_pre_strategy_led(&amp;parameters);
set_reference_voltage();</action>
      <tran_glyph conn="35,68,3,-1,12">
       <action box="0,-2,31,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::BLE_DATA_REQUEST}-->
     <tran trig="BLE_DATA_REQUEST" target="../../12">
      <tran_glyph conn="35,75,3,1,-3,3,-8">
       <action box="0,-2,19,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::BLE_DATA_UPDATE}-->
     <tran trig="BLE_DATA_UPDATE">
      <action>ble_rcv_packet_t last_data;
ble_service_last_packet(&amp;last_data);
param_error_t stat = parameters_update_from_ble(&amp;parameters, last_data.data);
if (stat == PARAM_OK){
    buzzer_start();
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 200);
}</action>
      <tran_glyph conn="35,71,3,-1,14">
       <action box="0,-2,20,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::LINE_CHANGED_BL, LINE_CHANGED_BR~}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR, LINE_CHANGED_FL, LINE_CHANGED_FR">
      <action brief="buzzer_on">if (adc_line_none_white()){
    buzzer_stop();
} else {
    buzzer_start();
}

parameters_report(parameters, 2);</action>
      <tran_glyph conn="35,79,3,-1,19">
       <action box="0,-2,34,6"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::DIST_SENSOR_CHANGE}-->
     <tran trig="DIST_SENSOR_CHANGE">
      <action>parameters_report(parameters, 2);</action>
      <!--${AOs::SumoHSM::SM::AutoWait::DIST_SENSOR_CHAN~::[attack_when_near]}-->
      <choice target="../../../8" cpref="../../../41/0">
       <guard brief="attack_when_near">parameters.attack_when_near &amp;&amp; (distance_is_active(DIST_SENSOR_F) || distance_is_active(DIST_SENSOR_DR) || distance_is_active(DIST_SENSOR_DL))</guard>
       <action brief="driving_enable">driving_enable();
radio_service_disable();
BSP_eeprom_write(EE_CURRENT_STATE_ADDR, AUTO_RUNNING);</action>
       <choice_glyph conn="19,85,5,0,-4,26,10,2">
        <action box="-3,2,14,7"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="35,85,3,-1,-16">
       <action box="0,-2,22,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::BLE_ATTACK_NEAR}-->
     <tran trig="BLE_ATTACK_NEAR">
      <action>parameters.attack_when_near = !parameters.attack_when_near;
if (parameters.attack_when_near){
    led_stripe_set_all_color(COLOR_RED);
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 1000);
    buzzer_start();
} else {
    led_stripe_set_all_color(COLOR_BLACK);
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 1000);
    buzzer_start();
}</action>
      <tran_glyph conn="35,88,3,-1,15">
       <action box="0,-2,15,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop()">buzzer_stop();</action>
      <tran_glyph conn="35,92,3,-1,17">
       <action box="0,-2,23,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoWait::START_MODULE_TEST}-->
     <tran trig="START_MODULE_TEST" target="../../38" cpref="../../46/0">
      <tran_glyph conn="35,61,5,1,-11">
       <action box="0,-2,21,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="35,47,36,54">
      <entry box="1,2,35,8"/>
      <exit box="1,10,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibTurnRight}-->
    <state name="CalibTurnRight">
     <entry brief="turn_90_right">imu_set_imu_enabled(parameters.imu_enabled);
imu_reset_pid();
imu_set_kp(parameters.kp);
imu_set_kd(parameters.kd);
imu_set_ki(parameters.ki);
imu_set_near_angle_th(parameters.near_angle_th);
imu_set_inclinated_th_x10(parameters.inclinated_th);
reset_inclination();
reset_imu_angle_z();

QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);

imu_set_setpoint(270);
imu_set_base_speed(0);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
     <!--${AOs::SumoHSM::SM::CalibTurnRight::IMU_UPDATED}-->
     <tran trig="IMU_UPDATED">
      <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
      <!--${AOs::SumoHSM::SM::CalibTurnRight::IMU_UPDATED::[near_set_point]}-->
      <choice target="../../../19">
       <guard brief="near_set_point">near_set_point() == true</guard>
       <choice_glyph conn="230,89,4,0,58">
        <action box="-12,5,12,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="218,89,3,-1,12">
       <action box="0,-2,13,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibTurnRight::STUCK}-->
     <tran trig="STUCK" target="../../19">
      <tran_glyph conn="218,86,3,0,-2,61">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="218,80,19,11">
      <entry box="1,2,16,3"/>
      <exit box="1,5,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibWait}-->
    <state name="CalibWait">
     <entry>board_led_on();
drive(0,0);
driving_disable();
parameters_set_calib_mode_led(&amp;parameters);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 250);
ble_service_send_string(&quot;state:CALIB&quot;);
radio_service_en_radio_data_sig(true);
me-&gt;stuck_counter = 0;
set_reference_voltage();

QEvt evt_restart_imu = { .sig = IMU_RESTART_SIG };
QHSM_DISPATCH(&amp;imu_service_AO-&gt;super, &amp;evt_restart_imu, SIMULATOR);</entry>
     <exit brief="StopTimer">QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
     <!--${AOs::SumoHSM::SM::CalibWait::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../1">
      <action>led_stripe_set_all_color(COLOR_PURPLE);
ble_service_send_string(&quot;state:IDLE&quot;);</action>
      <tran_glyph conn="259,13,0,1,-11,-153,15,-22">
       <action box="-152,-10,17,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::TIMEOUT}-->
     <tran trig="TIMEOUT">
      <action>static bool time_long;

board_led_toggle();

if (time_long){
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 150);
} else {
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 1000);
}
time_long = !time_long;

</action>
      <tran_glyph conn="249,33,3,-1,13">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::CHANGE_STRATEGY_EVT}-->
     <tran trig="CHANGE_STRATEGY_EVT">
      <action brief="update_calib_mode">parameters_update_calib_mode(&amp;parameters, (parameters.calib_mode + 1));
parameters_set_calib_mode_led(&amp;parameters);</action>
      <tran_glyph conn="249,40,3,-1,13">
       <action box="0,-2,23,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::BLE_DATA_REQUEST}-->
     <tran trig="BLE_DATA_REQUEST" target="../../14">
      <tran_glyph conn="275,28,1,3,17">
       <action box="0,-2,18,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::BLE_DATA_UPDATE}-->
     <tran trig="BLE_DATA_UPDATE">
      <action>ble_rcv_packet_t last_data;
ble_service_last_packet(&amp;last_data);
param_error_t stat = parameters_update_from_ble(&amp;parameters, last_data.data);
if (stat == PARAM_OK){
    buzzer_start();
    QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 200);
}</action>
      <tran_glyph conn="249,29,3,-1,13">
       <action box="0,-2,19,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA}-->
     <tran trig="RADIO_DATA">
      <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70]}-->
      <choice>
       <guard brief="|ch1| or |ch2|&gt; 70">(abs(radio_service_get_channel(RADIO_CH1)) &gt; 70) || (abs(radio_service_get_channel(RADIO_CH2)) &gt; 70)</guard>
       <action>driving_enable();
led_stripe_set_all_color(COLOR_RED);</action>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_0]}-->
       <choice target="../../../../4">
        <guard brief="calib_mode_0">parameters.calib_mode == 0</guard>
        <choice_glyph conn="261,67,5,0,-34,13">
         <action box="-36,-3,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_1]}-->
       <choice target="../../../../15">
        <guard brief="calib_mode_1">parameters.calib_mode == 1</guard>
        <choice_glyph conn="261,67,5,0,-8,13">
         <action box="-12,-3,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_2]}-->
       <choice target="../../../../6">
        <guard brief="calib_mode_2">parameters.calib_mode == 2</guard>
        <choice_glyph conn="261,67,5,0,23,13">
         <action box="18,-3,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_3]}-->
       <choice target="../../../../16">
        <guard brief="calib_mode_3">parameters.calib_mode == 3</guard>
        <choice_glyph conn="261,67,5,0,58,13">
         <action box="55,-3,12,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_4]}-->
       <choice target="../../../../20">
        <guard brief="calib_mode_4">parameters.calib_mode == 4</guard>
        <choice_glyph conn="261,67,5,0,103,13">
         <action box="91,-3,12,3"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_5]}-->
       <choice target="../../../../34">
        <guard brief="calib_mode_5">parameters.calib_mode == 5</guard>
        <choice_glyph conn="261,67,5,0,134,13">
         <action box="123,-3,13,3"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::CalibWait::RADIO_DATA::[|ch1|or|ch2|>70~::[calib_mode_6]}-->
       <choice target="../../../../39">
        <guard brief="calib_mode_6">parameters.calib_mode == 6</guard>
        <choice_glyph conn="261,67,5,0,182,12">
         <action box="152,-3,10,2"/>
        </choice_glyph>
       </choice>
       <choice_glyph conn="261,60,4,-1,7">
        <action box="1,0,10,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="249,49,3,-1,12,11">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::CHANGE_PRE_STRATEGY_EVT}-->
     <tran trig="CHANGE_PRE_STRATEGY_EVT">
      <action brief="update_parameters()">/*
buzzer_start();
QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 100);


switch (parameters.calib_mode)
{
    case 0: {
        parameters.kp += 100;
        if (parameters.kp &gt; 5000){
            parameters.kp = 500;
        }
        BSP_eeprom_write(EE_KP_ADDR, parameters.kp);
        break;
    }

    case 1: {
        parameters.near_angle_th += 1;
        if (parameters.near_angle_th &gt; 15){
            parameters.near_angle_th = 0;
        }
        BSP_eeprom_write(EE_NEAR_ANGLE_TH_ADDR, parameters.near_angle_th);
        break;
    }

    case 2: {
        parameters.time_ms_to_cross_at_max_vel += 10;
        if (parameters.time_ms_to_cross_at_max_vel &gt; 500){
            parameters.time_ms_to_cross_at_max_vel = 100;
        }
        BSP_eeprom_write(TIME_MS_TO_CROSS_AT_100_ADDR, parameters.time_ms_to_cross_at_max_vel);
        break;
    }

    case 3: {
         parameters.star_speed += 2;
        if (parameters.star_speed &gt; 98){
            parameters.star_speed = 30;
        }
        BSP_eeprom_write(STAR_SPEED_ADDR, parameters.star_speed);
        break;
    }

    case 4: {
        // Not aplicable
        break;
    }

    default: {
        break;    
    }

}
*/
</action>
      <tran_glyph conn="249,44,3,-1,18">
       <action box="0,-2,25,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibWait::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop">buzzer_stop();</action>
      <tran_glyph conn="249,22,3,-1,10">
       <action box="0,-2,17,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="249,13,26,40">
      <entry box="1,2,12,2"/>
      <exit box="1,4,13,3"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibFrontAt100}-->
    <state name="CalibFrontAt100">
     <entry brief="move front">imu_set_imu_enabled(parameters.imu_enabled);
imu_reset_pid();
imu_set_kp(parameters.kp);
imu_set_kd(parameters.kd);
imu_set_ki(parameters.ki);
imu_set_near_angle_th(parameters.near_angle_th);
imu_set_inclinated_th_x10(parameters.inclinated_th);
reset_inclination();
reset_imu_angle_z();

imu_set_setpoint(0);
imu_set_base_speed(100);

uint32_t move_time = BSP_TICKS_PER_MILISSEC * parameters.time_ms_to_cross_at_max_vel;

QTimeEvt_rearm(&amp;me-&gt;timeEvt,  move_time);</entry>
     <!--${AOs::SumoHSM::SM::CalibFrontAt100::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../37">
      <tran_glyph conn="272,90,3,3,-3,13,2">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibFrontAt100::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../19">
      <tran_glyph conn="272,87,3,0,-5,60">
       <action box="0,-2,19,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibFrontAt100::IMU_UPDATED}-->
     <tran trig="IMU_UPDATED">
      <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
      <tran_glyph conn="272,93,3,-1,12">
       <action box="0,-2,13,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="272,80,25,16">
      <entry box="1,2,14,4"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::RC_0_1}-->
    <state name="RC_0_1">
     <entry>board_led_off();
led_stripe_set_all_color(COLOR_ORANGE);</entry>
     <!--${AOs::SumoHSM::SM::RC_0_1::RADIO_DATA}-->
     <tran trig="RADIO_DATA">
      <action>int coord_x = radio_service_get_channel(RADIO_CH1);
int coord_y = radio_service_get_channel(RADIO_CH2);

int mot1 = coord_y + coord_x;
int mot2 = coord_y - coord_x;

drive(mot1, mot2);

QTimeEvt_rearm(&amp;me-&gt;timerFailSafe, 1 * BSP_TICKS_PER_SEC);
</action>
      <tran_glyph conn="114,135,3,-1,12">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_0_1::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT">
      <!--${AOs::SumoHSM::SM::RC_0_1::CHANGE_STATE_EVT::[|ch1|and|ch2|<10]}-->
      <choice target="../../../2">
       <guard brief="|ch1| and |ch2|&lt; 10">(abs(radio_service_get_channel(RADIO_CH1)) &lt; 10) &amp;&amp; (abs(radio_service_get_channel(RADIO_CH2)) &lt; 10)</guard>
       <action brief="save">BSP_eeprom_write(EE_CURRENT_STATE_ADDR, STATE_IDLE);</action>
       <choice_glyph conn="173,114,4,1,-41,-9">
        <action box="-14,4,16,4"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="114,140,3,-1,21,-19,38,-7">
       <action box="0,-3,18,3"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_0_1::FAILSAFE}-->
     <tran trig="FAILSAFE">
      <action>drive(0,0);</action>
      <tran_glyph conn="114,143,3,-1,10">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_0_1::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR">
      <!--${AOs::SumoHSM::SM::RC_0_1::LINE_CHANGED_BL,~::[strategy_1&&white]}-->
      <choice target="../../../29">
       <guard brief="strategy_1 &amp;&amp; white">parameters.strategy == 1 &amp;&amp; (adc_line_is_white(LINE_BL) || adc_line_is_white(LINE_BR))</guard>
       <choice_glyph conn="115,175,4,0,17">
        <action box="-8,0,8,3"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="114,159,3,-1,1,16">
       <action box="0,-5,16,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_0_1::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR">
      <!--${AOs::SumoHSM::SM::RC_0_1::LINE_CHANGED_FL,~::[strategy_1&&white]}-->
      <choice target="../../../30">
       <guard brief="strategy_1 &amp;&amp; white">parameters.strategy == 1 &amp;&amp; (adc_line_is_white(LINE_FL) || adc_line_is_white(LINE_FR))</guard>
       <choice_glyph conn="129,176,4,0,16">
        <action box="-8,7,9,3"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="114,153,3,-1,17,18,-2,5">
       <action box="0,-5,16,5"/>
      </tran_glyph>
     </tran>
     <state_glyph node="114,125,20,42">
      <entry box="1,2,12,4"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::pre_strategy}-->
    <smstate name="pre_strategy" submachine="../41">
     <!--${AOs::SumoHSM::SM::pre_strategy::XP1}-->
     <xpseg xpref="../../41/20">
      <!--${AOs::SumoHSM::SM::pre_strategy::XP1::[strategy_0]}-->
      <choice target="../../../22">
       <guard brief="strategy_0">parameters.strategy == 0</guard>
       <choice_glyph conn="52,128,5,0,-23,6">
        <action box="-16,0,10,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::pre_strategy::XP1::[strategy_1]}-->
      <choice target="../../../25">
       <guard brief="strategy_1">parameters.strategy == 1</guard>
       <choice_glyph conn="52,128,5,0,13,6">
        <action box="3,0,10,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::pre_strategy::XP1::[else]}-->
      <choice target="../../../25">
       <guard>else</guard>
       <choice_glyph conn="52,128,5,0,21,6">
        <action box="15,0,10,2"/>
       </choice_glyph>
      </choice>
      <xpseg_glyph conn="33,123,2,-1,2,19,3">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::pre_strategy::STOP_XP}-->
     <xpseg xpref="../../41/21" target="../../9">
      <xpseg_glyph conn="23,117,3,3,-19,121,2">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::pre_strategy::F_LINE}-->
     <xpseg xpref="../../41/22">
      <!--${AOs::SumoHSM::SM::pre_strategy::F_LINE::[else]}-->
      <choice target="../../../27">
       <guard brief="else">else</guard>
       <choice_glyph conn="101,186,5,2,-47,-14">
        <action box="-47,-3,5,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::pre_strategy::F_LINE::[strategy_0]}-->
      <choice target="../../../23">
       <guard brief="strategy_0">parameters.strategy == 0</guard>
       <choice_glyph conn="101,186,5,2,-86,-13">
        <action box="-86,-3,10,2"/>
       </choice_glyph>
      </choice>
      <xpseg_glyph conn="41,123,2,-1,2,60,61">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="23,114,57,9"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::AutoEnd}-->
    <state name="AutoEnd">
     <entry brief="Disable Motors">drive(0,0);
driving_disable();
radio_service_enable();
board_led_off();
led_stripe_set_all_color(COLOR_BLACK);
ble_service_send_string(&quot;state:AUTOEND&quot;);
buzzer_start();
QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 300);
start_module_disable();
BSP_eeprom_write(EE_CURRENT_STATE_ADDR, STATE_IDLE);</entry>
     <!--${AOs::SumoHSM::SM::AutoEnd::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../3">
      <tran_glyph conn="6,241,3,3,-4,-144,33">
       <action box="1,-1,23,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::AutoEnd::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop()">buzzer_stop();</action>
      <tran_glyph conn="6,245,3,-1,24">
       <action box="0,-2,31,3"/>
      </tran_glyph>
     </tran>
     <state_glyph node="6,233,183,15">
      <entry box="1,2,12,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::pre_strategy_rc}-->
    <smstate name="pre_strategy_rc" submachine="../41">
     <!--${AOs::SumoHSM::SM::pre_strategy_rc::XP1}-->
     <xpseg xpref="../../41/20">
      <!--${AOs::SumoHSM::SM::pre_strategy_rc::XP1::[else]}-->
      <choice target="../../../7">
       <guard brief="else">else</guard>
       <choice_glyph conn="139,111,5,0,-12,14">
        <action box="-7,0,10,2"/>
       </choice_glyph>
      </choice>
      <!--${AOs::SumoHSM::SM::pre_strategy_rc::XP1::[strategy_2]}-->
      <choice target="../../../28">
       <guard brief="strategy_2">parameters.strategy == 2</guard>
       <choice_glyph conn="139,111,5,0,12,14">
        <action box="1,0,10,2"/>
       </choice_glyph>
      </choice>
      <xpseg_glyph conn="131,107,2,-1,2,8,2">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::pre_strategy_rc::STOP_XP}-->
     <xpseg xpref="../../41/21" target="../../7">
      <xpseg_glyph conn="123,102,3,0,-4,23">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::pre_strategy_rc::F_LINE}-->
     <xpseg xpref="../../41/22" target="../../32">
      <xpseg_glyph conn="138,107,2,2,2,58,93,-36,-5">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="123,100,46,7"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::ble1}-->
    <smstate name="ble1" submachine="../42">
     <!--${AOs::SumoHSM::SM::ble1::XP1}-->
     <xpseg xpref="../../42/0" target="../../1">
      <xpseg_glyph conn="32,8,1,3,9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="15,6,17,6"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::ble2}-->
    <smstate name="ble2" submachine="../42">
     <!--${AOs::SumoHSM::SM::ble2::XP1}-->
     <xpseg xpref="../../42/0" target="../../3">
      <xpseg_glyph conn="24,75,1,3,2,-2,9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="11,72,13,7"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::ble3}-->
    <smstate name="ble3" submachine="../42">
     <!--${AOs::SumoHSM::SM::ble3::XP1}-->
     <xpseg xpref="../../42/0" target="../../2">
      <xpseg_glyph conn="163,10,1,1,20,26,-19">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="137,7,26,8"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::ble4}-->
    <smstate name="ble4" submachine="../42">
     <!--${AOs::SumoHSM::SM::ble4::XP1}-->
     <xpseg xpref="../../42/0" target="../../5">
      <xpseg_glyph conn="317,25,1,1,4,11,-46">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="292,21,25,9"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::CalibTurnLeft}-->
    <state name="CalibTurnLeft">
     <entry brief="turn_45_left">imu_set_imu_enabled(parameters.imu_enabled);
imu_reset_pid();
imu_set_kp(parameters.kp);
imu_set_kd(parameters.kd);
imu_set_ki(parameters.ki);
imu_set_near_angle_th(parameters.near_angle_th);
imu_set_inclinated_th_x10(parameters.inclinated_th);
reset_inclination();
reset_imu_angle_z();

QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);

imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
     <!--${AOs::SumoHSM::SM::CalibTurnLeft::STUCK}-->
     <tran trig="STUCK" target="../../19">
      <tran_glyph conn="244,86,3,0,-2,61">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibTurnLeft::IMU_UPDATED}-->
     <tran trig="IMU_UPDATED">
      <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
      <!--${AOs::SumoHSM::SM::CalibTurnLeft::IMU_UPDATED::[near_set_point]}-->
      <choice target="../../../19">
       <guard brief="near_set_point">near_set_point() == true</guard>
       <choice_glyph conn="256,89,4,0,58">
        <action box="-12,5,12,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="244,89,3,-1,12">
       <action box="0,-2,13,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="244,80,18,11">
      <entry box="1,2,16,3"/>
      <exit box="1,5,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibStarTopSpeed}-->
    <state name="CalibStarTopSpeed">
     <entry brief="Drive(100,100)">imu_set_imu_enabled(parameters.imu_enabled);
imu_reset_pid();
imu_set_kp(parameters.kp);
imu_set_kd(parameters.kd);
imu_set_ki(parameters.ki);
imu_set_near_angle_th(parameters.near_angle_th);
imu_set_inclinated_th_x10(parameters.inclinated_th);
reset_inclination();
reset_imu_angle_z();

drive(100, 100);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * parameters.star_full_speed_time_ms);</entry>
     <!--${AOs::SumoHSM::SM::CalibStarTopSpee~::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR" target="../../17">
      <tran_glyph conn="305,88,3,3,-5,33,5">
       <action box="0,-2,31,3"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStarTopSpee~::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../19">
      <tran_glyph conn="336,92,1,0,5,55">
       <action box="-18,-2,18,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStarTopSpee~::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../33">
      <tran_glyph conn="305,91,3,3,-2,11,2">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="305,80,31,13">
      <entry box="1,2,28,7"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibStarGoBack}-->
    <state name="CalibStarGoBack">
     <entry>reset_imu_angle_z();

imu_set_base_speed(-parameters.reverse_speed);
imu_set_setpoint(0);

uint32_t reverse_time = BSP_TICKS_PER_MILISSEC * parameters.reverse_time_ms;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, reverse_time);</entry>
     <!--${AOs::SumoHSM::SM::CalibStarGoBack::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../18">
      <tran_glyph conn="305,123,3,3,-3,11,3">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStarGoBack::IMU_UPDATED}-->
     <tran trig="IMU_UPDATED">
      <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
      <tran_glyph conn="305,126,3,-1,12">
       <action box="0,-2,13,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="305,116,31,12">
      <entry box="1,2,9,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibeStarTurn}-->
    <state name="CalibeStarTurn">
     <entry brief="turn">imu_set_setpoint(360 - parameters.line_seen_turn_angle);
imu_set_base_speed(0);

uint16_t max_turn_time_ms = 600;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * max_turn_time_ms);</entry>
     <!--${AOs::SumoHSM::SM::CalibeStarTurn::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../19">
      <tran_glyph conn="305,137,3,0,-3,10">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibeStarTurn::IMU_UPDATED}-->
     <tran trig="IMU_UPDATED">
      <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
      <!--${AOs::SumoHSM::SM::CalibeStarTurn::IMU_UPDATED::[near_set_point]}-->
      <choice target="../../../19">
       <guard brief="near_set_point">near_set_point() == true</guard>
       <choice_glyph conn="321,140,4,0,7">
        <action box="-14,2,14,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="305,140,3,-1,16">
       <action box="0,-2,13,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="305,130,31,12">
      <entry box="1,2,8,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibStop}-->
    <state name="CalibStop">
     <entry>drive(0,0);
//driving_disable();
board_led_off();
led_stripe_set_all_color(COLOR_BLACK);
ble_service_send_string(&quot;state:CALIBEND&quot;);
buzzer_start();
QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 300);</entry>
     <!--${AOs::SumoHSM::SM::CalibStop::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../14">
      <tran_glyph conn="412,152,1,1,68,-123,-163">
       <action box="-18,-1,19,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStop::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop()">buzzer_stop();
drive(0,0);</action>
      <tran_glyph conn="211,155,3,-1,25">
       <action box="0,-2,31,3"/>
      </tran_glyph>
     </tran>
     <state_glyph node="211,147,201,12">
      <entry box="1,2,36,4"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibSensors}-->
    <state name="CalibSensors">
     <entry>QTimeEvt_rearm(&amp;me-&gt;timeEvt,  BSP_TICKS_PER_MILISSEC * 100);</entry>
     <!--${AOs::SumoHSM::SM::CalibSensors::TIMEOUT}-->
     <tran trig="TIMEOUT">
      <action>QTimeEvt_rearm(&amp;me-&gt;timeEvt,  BSP_TICKS_PER_MILISSEC * 100);
report_raw_line_data_ble();</action>
      <tran_glyph conn="351,89,3,-1,14">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibSensors::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../19">
      <tran_glyph conn="351,94,3,0,-3,53">
       <action box="1,-2,18,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="351,80,26,18">
      <entry box="1,2,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::RCAutomaticStart}-->
    <state name="RCAutomaticStart">
     <entry brief="attack">board_led_off();
drive(100,100);
uint32_t attack_timeout = 150 * BSP_TICKS_PER_MILISSEC;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, attack_timeout);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
led_stripe_set_all_color(COLOR_RED);</exit>
     <!--${AOs::SumoHSM::SM::RCAutomaticStart::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../10" cpref="../../41/0">
      <tran_glyph conn="99,105,3,0,15,-8,11,2">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="99,94,17,13">
      <entry box="1,2,12,4"/>
      <exit box="1,6,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::StarAuto}-->
    <smstate name="StarAuto" submachine="../43">
     <!--${AOs::SumoHSM::SM::StarAuto::STOP_XP}-->
     <xpseg xpref="../../43/0" target="../../9">
      <xpseg_glyph conn="13,153,3,0,-3,80">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::StarAuto::LINE_FRONT}-->
     <xpseg xpref="../../43/1" target="../../23">
      <xpseg_glyph conn="21,155,2,0,2,1,9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::StarAuto::LINE_BACK}-->
     <xpseg xpref="../../43/2" target="../../24">
      <xpseg_glyph conn="31,155,2,0,2,4,9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="13,134,30,21"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::LineFStar}-->
    <smstate name="LineFStar" submachine="../40">
     <!--${AOs::SumoHSM::SM::LineFStar::STOP_XP}-->
     <xpseg xpref="../../40/1" target="../../9">
      <xpseg_glyph conn="24,173,2,0,60">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::LineFStar::XP1}-->
     <xpseg xpref="../../40/0" target="../../22">
      <xpseg_glyph conn="24,166,0,2,-2,1,-9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="13,166,14,7"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::LineBStar}-->
    <smstate name="LineBStar" submachine="../44">
     <!--${AOs::SumoHSM::SM::LineBStar::XP1}-->
     <xpseg xpref="../../44/0" target="../../22">
      <xpseg_glyph conn="37,166,0,2,-2,1,-9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::LineBStar::STOP_XP}-->
     <xpseg xpref="../../44/1" target="../../9">
      <xpseg_glyph conn="37,173,2,0,2,1,58">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="29,166,13,7"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::StepsAuto}-->
    <smstate name="StepsAuto" submachine="../45">
     <!--${AOs::SumoHSM::SM::StepsAuto::LINE_FRONT}-->
     <xpseg xpref="../../45/1" target="../../27">
      <xpseg_glyph conn="58,155,2,0,2,3,8">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::StepsAuto::LINE_BACK}-->
     <xpseg xpref="../../45/0" target="../../26">
      <xpseg_glyph conn="70,155,2,0,2,6,8">
       <action box="0,1,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::StepsAuto::STOP_XP}-->
     <xpseg xpref="../../45/2" target="../../9">
      <xpseg_glyph conn="51,152,3,0,-4,81">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="51,134,37,21"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::StepsBL}-->
    <smstate name="StepsBL" submachine="../44">
     <!--${AOs::SumoHSM::SM::StepsBL::XP1}-->
     <xpseg xpref="../../44/0" target="../../25">
      <xpseg_glyph conn="81,165,0,2,-2,1,-8">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::StepsBL::STOP_XP}-->
     <xpseg xpref="../../44/1" target="../../9">
      <xpseg_glyph conn="81,172,2,0,2,1,59">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="72,165,15,7"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::StepsFL}-->
    <smstate name="StepsFL" submachine="../40">
     <!--${AOs::SumoHSM::SM::StepsFL::XP1}-->
     <xpseg xpref="../../40/0" target="../../25">
      <xpseg_glyph conn="64,165,0,2,-2,1,-8">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::StepsFL::STOP_XP}-->
     <xpseg xpref="../../40/1" target="../../9">
      <xpseg_glyph conn="64,172,2,0,61">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="52,165,15,7"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::RC_2}-->
    <state name="RC_2">
     <entry>board_led_off();
led_stripe_set_all_color(COLOR_ORANGE);</entry>
     <!--${AOs::SumoHSM::SM::RC_2::RADIO_DATA}-->
     <tran trig="RADIO_DATA">
      <action>int coord_x = radio_service_get_channel(RADIO_CH1);
int coord_y = radio_service_get_channel(RADIO_CH2);

int mot1 = coord_y + coord_x;
int mot2 = coord_y - coord_x;


// Auto if coord &gt; y
if (coord_y &gt;= 60) {
    // Only attack if it is not inclined
    if (!get_imu_inclination_stat()){
        bool seeing = SumoHSM_CheckDistAndMove(me);
        if (!seeing){
            drive(parameters.star_speed, parameters.star_speed);
        }
    }
} else {
    drive(mot1, mot2);
}



QTimeEvt_rearm(&amp;me-&gt;timerFailSafe, 1 * BSP_TICKS_PER_SEC);</action>
      <tran_glyph conn="143,135,3,-1,12">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_2::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT">
      <!--${AOs::SumoHSM::SM::RC_2::CHANGE_STATE_EVT::[|ch1|and|ch2|<10]}-->
      <choice target="../../../2">
       <guard brief="|ch1| and |ch2|&lt; 10">(abs(radio_service_get_channel(RADIO_CH1)) &lt; 10) &amp;&amp; (abs(radio_service_get_channel(RADIO_CH2)) &lt; 10)</guard>
       <action brief="e">BSP_eeprom_write(EE_CURRENT_STATE_ADDR, STATE_IDLE);</action>
       <choice_glyph conn="188,115,4,1,-46,-24">
        <action box="-12,-44,16,4"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="168,138,1,-1,20,-23">
       <action box="1,-3,17,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_2::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR">
      <!--${AOs::SumoHSM::SM::RC_2::LINE_CHANGED_FL,~::[white]}-->
      <choice target="../../../32">
       <guard brief="white">adc_line_is_white(LINE_FL) || adc_line_is_white(LINE_FR)</guard>
       <choice_glyph conn="165,152,4,0,37,2,2">
        <action box="-5,-5,6,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="143,144,3,-1,22,8">
       <action box="0,-2,18,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_2::FAILSAFE}-->
     <tran trig="FAILSAFE">
      <action>drive(0,0);</action>
      <tran_glyph conn="143,137,3,-1,12">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_2::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR">
      <!--${AOs::SumoHSM::SM::RC_2::LINE_CHANGED_BL,~::[white]}-->
      <choice target="../../../31">
       <guard brief="white">adc_line_is_white(LINE_BL) || adc_line_is_white(LINE_BR)</guard>
       <choice_glyph conn="160,161,5,0,-8,17">
        <action box="-8,-3,10,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="143,153,3,-1,17,8">
       <action box="0,-2,16,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_2::CHANGE_PRE_STRATEGY_EVT}-->
     <tran trig="CHANGE_PRE_STRATEGY_EVT" target="../../10" cpref="../../41/2">
      <tran_glyph conn="168,134,1,0,16,-40,-55,5">
       <action box="-7,-2,25,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::RC_2::IMU_INCLINATION}-->
     <tran trig="IMU_INCLINATION">
      <action>drive(-100, -60);</action>
      <tran_glyph conn="143,139,3,-1,15">
       <action box="0,-2,16,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="143,125,25,42">
      <entry box="1,2,12,4"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::LineBackRC}-->
    <state name="LineBackRC">
     <entry>drive(100,100);
uint32_t advance_time = BSP_TICKS_PER_MILISSEC * 100;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, advance_time);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
     <!--${AOs::SumoHSM::SM::LineBackRC::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../7">
      <tran_glyph conn="121,192,0,2,-25">
       <action box="-6,2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="110,192,13,8">
      <entry box="1,2,6,2"/>
      <exit box="1,4,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::LineFrontRC}-->
    <state name="LineFrontRC">
     <entry>drive(-100,-100);
uint32_t reverse_time = BSP_TICKS_PER_MILISSEC * parameters.reverse_time_ms;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, reverse_time);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
     <!--${AOs::SumoHSM::SM::LineFrontRC::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../7">
      <tran_glyph conn="136,192,0,1,-43,-2">
       <action box="-6,2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="125,192,13,8">
      <entry box="1,2,5,2"/>
      <exit box="1,4,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::LineB_RC}-->
    <smstate name="LineB_RC" submachine="../44">
     <!--${AOs::SumoHSM::SM::LineB_RC::XP1}-->
     <xpseg xpref="../../44/0" target="../../28">
      <xpseg_glyph conn="154,178,0,2,-2,1,-9">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::LineB_RC::STOP_XP}-->
     <xpseg xpref="../../44/1" target="../../28">
      <xpseg_glyph conn="153,184,2,2,3,9,-20">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="142,178,19,6"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::LineF_RC}-->
    <smstate name="LineF_RC" submachine="../40">
     <!--${AOs::SumoHSM::SM::LineF_RC::XP1}-->
     <xpseg xpref="../../40/0" target="../../28">
      <xpseg_glyph conn="169,191,0,1,-26,-1">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::LineF_RC::STOP_XP}-->
     <xpseg xpref="../../40/1" target="../../28">
      <xpseg_glyph conn="170,197,2,1,2,5,-36,-7">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="154,191,19,6"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::CalibStarSpeed}-->
    <state name="CalibStarSpeed">
     <entry brief="star_speed">imu_set_setpoint(0);
imu_set_base_speed(100);</entry>
     <!--${AOs::SumoHSM::SM::CalibStarSpeed::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR" target="../../17">
      <tran_glyph conn="305,105,3,3,-3,14,3">
       <action box="0,-2,24,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStarSpeed::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../19">
      <tran_glyph conn="336,104,1,0,3,43">
       <action box="-17,-3,19,3"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStarSpeed::IMU_UPDATED}-->
     <tran trig="IMU_UPDATED">
      <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
      <tran_glyph conn="305,111,3,-1,12">
       <action box="0,-2,13,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="305,98,31,15">
      <entry box="1,2,12,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibTurnSensors}-->
    <state name="CalibTurnSensors">
     <entry>bool seeing = true;
if (distance_is_active(DIST_SENSOR_F)){
    drive(0,0);
} else if (distance_is_active(DIST_SENSOR_FR) &amp;&amp; distance_is_active(DIST_SENSOR_FL)){
    drive(0,0);
} else if (distance_is_active(DIST_SENSOR_FR)) {
    drive(20,-20);
} else if (distance_is_active(DIST_SENSOR_FL)) {
    drive(-20,20);
} else if (distance_is_active(DIST_SENSOR_DR)) {
    drive(40,-40);
} else if (distance_is_active(DIST_SENSOR_DL)) {
    drive(-40,40);
} else if (distance_is_active(DIST_SENSOR_R)) {
    drive(80,-80);
} else if (distance_is_active(DIST_SENSOR_L)) {
    drive(-80,80);
} else {
   seeing = false;
   drive(0,0);
}

if (seeing) {
    QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * parameters.is_stucked_timeout_ms);
} else {
    QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
}
</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
     <!--${AOs::SumoHSM::SM::CalibTurnSensors::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../19">
      <tran_glyph conn="385,88,3,0,-5,59">
       <action box="0,-2,20,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibTurnSensors::DIST_SENSOR_CHANGE}-->
     <tran trig="DIST_SENSOR_CHANGE" target="..">
      <tran_glyph conn="409,88,1,1,4,4,-4">
       <action box="1,-3,20,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibTurnSensors::STUCK}-->
     <tran trig="STUCK" target="../../35">
      <tran_glyph conn="385,92,3,3,-2,15,2">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="385,80,24,18">
      <entry box="1,2,6,2"/>
      <exit box="1,4,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::CalibStuck}-->
    <state name="CalibStuck">
     <entry>uint16_t move_time_ms;

if (me-&gt;stuck_counter &gt;= 2){
    drive(-100,-35);
    move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
    me-&gt;stuck_counter = 0;
} else {
    drive(-100,-100);
    move_time_ms = get_time_to_move_ms(40, 100, &amp;parameters);
    me-&gt;stuck_counter++;
}


QTimeEvt_rearm(&amp;me-&gt;timeEvtStuckEnd, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuckEnd);</exit>
     <!--${AOs::SumoHSM::SM::CalibStuck::STUCK_END}-->
     <tran trig="STUCK_END" target="../../34">
      <tran_glyph conn="401,102,0,2,-4">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStuck::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR">
      <!--${AOs::SumoHSM::SM::CalibStuck::LINE_CHANGED_BL,~::[white]}-->
      <choice target="../../../36">
       <guard brief="white">adc_line_is_white(LINE_BL) || adc_line_is_white(LINE_BR)</guard>
       <choice_glyph conn="388,121,4,0,4">
        <action box="1,0,10,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="388,117,2,-1,4">
       <action box="4,-5,20,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibStuck::CHANGE_STATE_EVT}-->
     <tran trig="CHANGE_STATE_EVT" target="../../19">
      <tran_glyph conn="385,111,3,0,-3,36">
       <action box="0,-2,18,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="385,102,24,15">
      <entry box="1,2,6,2"/>
      <exit box="1,4,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::LineBackCalibStuck}-->
    <smstate name="LineBackCalibStuck" submachine="../44">
     <!--${AOs::SumoHSM::SM::LineBackCalibStu~::XP1}-->
     <xpseg xpref="../../44/0" target="../../34">
      <xpseg_glyph conn="400,125,0,1,-3,14,-26,-5">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::LineBackCalibStu~::STOP_XP}-->
     <xpseg xpref="../../44/1" target="../../19">
      <xpseg_glyph conn="399,133,2,0,2,2,12">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="385,125,24,8"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::CalibFrontAt100_stop}-->
    <state name="CalibFrontAt100_stop">
     <entry brief="move stop">QTimeEvt_rearm(&amp;me-&gt;timeEvt,  BSP_TICKS_PER_MILISSEC * 3000);
drive(0, 0);</entry>
     <!--${AOs::SumoHSM::SM::CalibFrontAt100_~::TIMEOUT}-->
     <tran trig="TIMEOUT" target="../../19">
      <tran_glyph conn="271,110,3,0,-2,37">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="271,100,25,13">
      <entry box="1,2,14,4"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::state1}-->
    <smstate name="state1" submachine="../46">
     <!--${AOs::SumoHSM::SM::state1::BLINK_END}-->
     <xpseg xpref="../../46/2" target="../../3">
      <xpseg_glyph conn="23,66,1,3,12">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <!--${AOs::SumoHSM::SM::state1::START}-->
     <xpseg xpref="../../46/1" target="../../8" cpref="../../41/0">
      <xpseg_glyph conn="8,68,2,0,43,17,2">
       <action box="1,0,10,2"/>
      </xpseg_glyph>
     </xpseg>
     <smstate_glyph node="4,59,19,9"/>
    </smstate>
    <!--${AOs::SumoHSM::SM::CalibImu}-->
    <state name="CalibImu">
     <entry>QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 12000);</entry>
     <!--${AOs::SumoHSM::SM::CalibImu::TIMEOUT}-->
     <tran trig="TIMEOUT">
      <action>start_g_bias_calculation();

QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, BSP_TICKS_PER_MILISSEC * 12000);</action>
      <tran_glyph conn="430,88,3,-1,13">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::CalibImu::TIMEOUT_2}-->
     <tran trig="TIMEOUT_2" target="../../19">
      <action>stop_g_bias_calculation();

parameters.acc_gbias = get_acc_gbias();
parameters.gyro_gbias = get_gyro_gbias();

BSP_eeprom_write(EE_ACC_BIAS_1_ADDR, (parameters.acc_gbias &gt;&gt; 16));
BSP_eeprom_write(EE_ACC_BIAS_2_ADDR, (parameters.acc_gbias &amp; 0xffff));


BSP_eeprom_write(EE_GYRO_BIAS_1_ADDR, (parameters.gyro_gbias &gt;&gt; 16));
BSP_eeprom_write(EE_GYRO_BIAS_2_ADDR, (parameters.gyro_gbias &amp; 0xffff));</action>
      <tran_glyph conn="430,93,3,1,24,57,-42">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <state_glyph node="430,79,20,22">
      <entry box="1,2,6,2"/>
     </state_glyph>
    </state>
    <!--${AOs::SumoHSM::SM::LineFrontSubmachine}-->
    <submachine name="LineFrontSubmachine">
     <entry>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
imu_reset_pid();</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
drive(0, 0);</exit>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::XP-XP1}-->
     <xp name="XP1">
      <xp_glyph point="72,2,0">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::XP-STOP_XP}-->
     <xp name="STOP_XP">
      <xp_glyph point="74,96,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::initial}-->
     <initial target="../4">
      <initial_glyph conn="6,6,5,0,11,3">
       <action box="0,-2,10,2"/>
      </initial_glyph>
     </initial>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::STOP, CHANGE_STATE_EVT}-->
     <tran trig="STOP, CHANGE_STATE_EVT" target=".." cpref="../1">
      <tran_glyph conn="90,90,1,2,-16,5">
       <action box="-15,-2,17,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack}-->
     <state name="LineGoBack">
      <entry brief="go_back">if (parameters.imu_enabled){
    reset_imu_angle_z();

    imu_set_base_speed(-parameters.reverse_speed);
    imu_set_setpoint(0);
} else {
    drive(-parameters.reverse_speed, -parameters.reverse_speed);
}

uint32_t reverse_time = BSP_TICKS_PER_MILISSEC * parameters.reverse_time_ms;

if (adc_line_is_white(LINE_FL)){
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, reverse_time);
} else {
    QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, reverse_time);
}

led_stripe_set_all_color(COLOR_YELLOW);</entry>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::TIMEOUT}-->
      <tran trig="TIMEOUT">
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::TIMEOUT::[distance_none_active()]}-->
       <choice target="../../../5">
        <guard brief="distance_none_active()">distance_none_active()</guard>
        <choice_glyph conn="17,32,4,0,12">
         <action box="1,4,19,3"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::TIMEOUT::[else]}-->
       <choice target="../../.." cpref="../../../0">
        <guard brief="else">else</guard>
        <choice_glyph conn="17,32,5,0,55,-29">
         <action box="1,0,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="7,25,3,-1,10,7">
        <action box="0,-2,16,4"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::TIMEOUT_2}-->
      <tran trig="TIMEOUT_2">
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::TIMEOUT_2::[distance_none_active()]}-->
       <choice target="../../../6">
        <guard brief="distance_none_active()">distance_none_active()</guard>
        <choice_glyph conn="45,38,4,0,6">
         <action box="1,1,19,3"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::TIMEOUT_2::[else]}-->
       <choice target="../../.." cpref="../../../0">
        <guard brief="else">else</guard>
        <choice_glyph conn="45,38,5,0,27,-35">
         <action box="2,-2,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="7,20,3,-1,38,18">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
      <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR" target="../.." cpref="../../0">
       <tran_glyph conn="7,16,3,0,65,-13">
        <action box="0,-2,19,5"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineGoBack::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="7,22,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="7,9,54,19">
       <entry box="1,2,16,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRight}-->
     <state name="LineTurnRight">
      <entry brief="turn right">if (parameters.imu_enabled){
    imu_set_setpoint(360 - parameters.line_seen_turn_angle);
    imu_set_base_speed(0);

    uint16_t max_turn_time_ms = 600;
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * max_turn_time_ms);
} else {
    drive(100, -100);
    uint16_t turn_time_ms = get_time_to_turn_ms(parameters.line_seen_turn_angle, 100, SIDE_RIGHT, &amp;parameters);
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * turn_time_ms);
}

led_stripe_set_all_color(COLOR_PINK);

</entry>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRight::TIMEOUT, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT, DIST_SENSOR_CHANGE" target="../../7">
       <tran_glyph conn="11,52,3,0,19,21">
        <action box="0,-2,22,6"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRight::LINE_CHANGED_FL, LINE_CHANGED_FR~}-->
      <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR, LINE_CHANGED_BL, LINE_CHANGED_BR">
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRight::LINE_CHANGED_FL,~::[white]}-->
       <choice target="../../../7">
        <guard brief="white">(adc_line_get_all() != 0)</guard>
        <choice_glyph conn="20,69,4,0,4">
         <action box="1,0,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="11,63,3,-1,9,6">
        <action box="0,-2,12,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRight::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRight::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../7">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="27,59,4,0,14">
         <action box="-10,-4,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="11,59,3,-1,16">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="11,44,21,22">
       <entry box="1,2,10,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeft}-->
     <state name="LineTurnLeft">
      <entry brief="turn left">if (parameters.imu_enabled){
    imu_set_setpoint(parameters.line_seen_turn_angle);
    imu_set_base_speed(0);

    uint16_t max_turn_time_ms = 600;
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * max_turn_time_ms);
} else {
    drive(-100, 100);
    uint16_t turn_time_ms = get_time_to_turn_ms(parameters.line_seen_turn_angle, 100, SIDE_LEFT, &amp;parameters);
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * turn_time_ms);
}

led_stripe_set_all_color(COLOR_PINK);
</entry>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeft::TIMEOUT, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT, DIST_SENSOR_CHANGE" target="../../8">
       <tran_glyph conn="38,53,3,0,19,20">
        <action box="0,-2,21,6"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeft::LINE_CHANGED_FL, LINE_CHANGED_FR~}-->
      <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR, LINE_CHANGED_BL, LINE_CHANGED_BR">
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeft::LINE_CHANGED_FL,~::[white]}-->
       <choice target="../../../8">
        <guard brief="white">(adc_line_get_all() != 0)</guard>
        <choice_glyph conn="45,68,4,0,5">
         <action box="1,0,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="38,64,3,-1,7,4">
        <action box="0,-2,12,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeft::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeft::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../8">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="54,60,4,0,13">
         <action box="-10,-4,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="38,60,3,-1,16">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="38,44,21,22">
       <entry box="1,2,10,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRightBreak}-->
     <state name="LineTurnRightBreak">
      <entry brief="turn left">drive(-20, 20);
uint16_t turn_time_ms = 5;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * turn_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRightBre~::TIMEOUT, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT, DIST_SENSOR_CHANGE">
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRightBre~::TIMEOUT, DIST_SE~::[white]}-->
       <choice target="../..">
        <guard brief="white">(adc_line_get_all() != 0)</guard>
        <choice_glyph conn="6,78,5,3,5">
         <action box="-1,-4,5,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnRightBre~::TIMEOUT, DIST_SE~::[else]}-->
       <choice target="../../.." cpref="../../../0">
        <guard>else</guard>
        <choice_glyph conn="6,78,5,0,-3,15,69,-90">
         <action box="-1,13,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="11,82,3,-1,-5,-4">
        <action box="0,-2,20,5"/>
       </tran_glyph>
      </tran>
      <state_glyph node="11,73,20,16">
       <entry box="1,2,13,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeftBreak}-->
     <state name="LineTurnLeftBreak">
      <entry brief="turn right">drive(20, -20);
uint16_t turn_time_ms = 5;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * turn_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeftBrea~::TIMEOUT, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT, DIST_SENSOR_CHANGE">
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeftBrea~::TIMEOUT, DIST_SE~::[white]}-->
       <choice target="../..">
        <guard brief="white">(adc_line_get_all() != 0)</guard>
        <choice_glyph conn="63,81,4,1,-3,-4">
         <action box="-3,-6,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::LineFrontSubmach~::LineTurnLeftBrea~::TIMEOUT, DIST_SE~::[else]}-->
       <choice target="../../.." cpref="../../../0">
        <guard>else</guard>
        <choice_glyph conn="63,81,5,0,9,-78">
         <action box="1,0,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="38,85,3,-1,25,-4">
        <action box="0,-2,22,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="38,73,21,16">
       <entry box="1,2,10,2"/>
      </state_glyph>
     </state>
     <submachine_diagram size="88,94">
      <entry box="1,2,6,2"/>
      <exit box="1,4,6,2"/>
     </submachine_diagram>
    </submachine>
    <!--${AOs::SumoHSM::SM::PreStrategy}-->
    <submachine name="PreStrategy">
     <entry brief="Disable_timers">QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
led_stripe_set_all_color(COLOR_RED);
imu_set_imu_enabled(parameters.imu_enabled);
imu_reset_pid();
imu_set_kp(parameters.kp);
imu_set_kd(parameters.kd);
imu_set_ki(parameters.ki);
imu_set_near_angle_th(parameters.near_angle_th);
imu_set_inclinated_th_x10(parameters.inclinated_th);
reset_inclination();
reset_imu_angle_z();
QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 400);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP0}-->
     <epseg name="EP0" target="../26">
      <epseg_glyph conn="19,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP1}-->
     <epseg name="EP1" target="../32">
      <epseg_glyph conn="41,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP2}-->
     <epseg name="EP2" target="../28">
      <epseg_glyph conn="65,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP3}-->
     <epseg name="EP3" target="../27">
      <epseg_glyph conn="89,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP4}-->
     <epseg name="EP4" target="../33">
      <epseg_glyph conn="113,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP5}-->
     <epseg name="EP5" target="../46">
      <epseg_glyph conn="137,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP6}-->
     <epseg name="EP6" target="../35">
      <epseg_glyph conn="161,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP7}-->
     <epseg name="EP7" target="../34">
      <epseg_glyph conn="185,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP10}-->
     <epseg name="EP10" target="../41">
      <epseg_glyph conn="257,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP8}-->
     <epseg name="EP8" target="../38">
      <epseg_glyph conn="208,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP9}-->
     <epseg name="EP9" target="../39">
      <epseg_glyph conn="232,2,0,0,8">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP11}-->
     <epseg name="EP11" target="../41">
      <epseg_glyph conn="281,2,0,0,3,-20,5">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP12}-->
     <epseg name="EP12" target="../48">
      <epseg_glyph conn="304,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP13}-->
     <epseg name="EP13" target="../48">
      <epseg_glyph conn="322,2,0,0,4,-12,2">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP14}-->
     <epseg name="EP14" target="../44">
      <epseg_glyph conn="340,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP15}-->
     <epseg name="EP15" target="../36">
      <epseg_glyph conn="363,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP16}-->
     <epseg name="EP16" target="../51">
      <epseg_glyph conn="386,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP17}-->
     <epseg name="EP17" target="../52">
      <epseg_glyph conn="409,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP18}-->
     <epseg name="EP18" target="../53">
      <epseg_glyph conn="434,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::EP-EP19}-->
     <epseg name="EP19" target="../57">
      <epseg_glyph conn="465,2,0,0,6">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::PreStrategy::XP-XP1}-->
     <xp name="XP1">
      <xp_glyph point="91,124,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::PreStrategy::XP-STOP_XP}-->
     <xp name="STOP_XP">
      <xp_glyph point="2,39,3">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::PreStrategy::XP-F_LINE}-->
     <xp name="F_LINE">
      <xp_glyph point="164,124,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::PreStrategy::STOP}-->
     <tran trig="STOP" target=".." cpref="../21">
      <tran_glyph conn="2,45,3,3,3,-6,-2">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::PreStrategy::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR">
      <!--${AOs::SumoHSM::SM::PreStrategy::LINE_CHANGED_FL,~::[white]}-->
      <choice target="../.." cpref="../../22">
       <guard brief="white">adc_line_is_white(LINE_FL) || adc_line_is_white(LINE_FR)</guard>
       <choice_glyph conn="156,119,5,2,8,4">
        <action box="1,0,10,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="134,124,2,-1,-5,22">
       <action box="0,-8,21,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::PreStrategy::STUCK}-->
     <tran trig="STUCK" target=".." cpref="../20">
      <tran_glyph conn="2,115,3,2,89,8">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_None}-->
     <state name="PreStrategy_None">
      <entry brief="motor_on">drive(100,100);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 10);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_None::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../20">
       <tran_glyph conn="8,20,3,2,22,95,61,8">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="8,10,18,14">
       <entry box="1,2,14,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy__DiagRight}-->
     <state name="PreStrategy__DiagRight">
      <entry brief="turn_right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 400);
imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy__Dia~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy__Dia~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../29">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="92,20,4,0,8">
         <action box="-12,5,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="80,20,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="80,10,18,14">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_DiagLeft}-->
     <state name="PreStrategy_DiagLeft">
      <entry brief="turn_left">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 400);
imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Diag~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Diag~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../31">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="68,20,4,0,8">
         <action box="-12,5,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="56,20,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="56,10,18,14">
       <entry box="1,2,16,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_3_sub1}-->
     <state name="PreStrategy_3_sub1">
      <entry brief="motor_front">imu_set_setpoint(315);
imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(55, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_3_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="80,36,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_3_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../40">
       <tran_glyph conn="80,40,3,0,12,6">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="80,28,18,14">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_2_sub2}-->
     <state name="PreStrategy_2_sub2">
      <entry brief="turn_right">imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_2_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_2_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="68,58,4,2,57,23,8">
         <action box="-12,3,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="56,58,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="56,46,18,14">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_2_sub1}-->
     <state name="PreStrategy_2_sub1">
      <entry brief="motor_front">imu_set_setpoint(45);
imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(55, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_2_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../30">
       <tran_glyph conn="56,40,3,0,12,6">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_2_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="56,36,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="56,28,18,14">
       <entry box="1,2,15,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Custom}-->
     <state name="PreStrategy_Custom">
      <entry brief="custom_strategy">// Max timeout to be in pre strategy state
QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 400);
cust_strategy_reset();
SumoHSM_UpdateCustomStrategy(me);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Cust~::TIMEOUT}-->
      <tran trig="TIMEOUT">
       <action>// Timeout occurs when parameter is front or back
cust_strategy_increase_step();
SumoHSM_UpdateCustomStrategy(me);</action>
       <tran_glyph conn="32,19,3,-1,10">
        <action box="0,-2,12,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Cust~::EXIT_CUSTOM}-->
      <tran trig="EXIT_CUSTOM" target="../.." cpref="../../20">
       <tran_glyph conn="32,28,3,2,-2,87,61,8">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Cust~::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
      <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR" target="../../37">
       <tran_glyph conn="32,33,3,0,15,13">
        <action box="0,-2,17,5"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Cust~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>// if (move left or right) and near_set_point, change parameter

int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}

uint8_t current_step = cust_strategy_current_step();
movement_t step_type = cust_strategy_move_type(current_step);

if (step_type == MOVE_TURN &amp;&amp; near_set_point()) {
    cust_strategy_increase_step();
    SumoHSM_UpdateCustomStrategy(me);
}
</action>
       <tran_glyph conn="32,22,3,-1,11">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="32,10,18,32">
       <entry box="1,2,15,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_OmaeLeft}-->
     <state name="PreStrategy_OmaeLeft">
      <entry brief="turn_left">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_setpoint(55);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Omae~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Omae~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../58">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="116,17,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="104,17,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="104,10,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ArcRight}-->
     <state name="PreStrategy_ArcRight">
      <entry brief="turn_right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ArcR~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ArcR~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../67">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="188,20,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="176,20,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="176,10,18,12">
       <entry box="1,2,15,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ArcLeft}-->
     <state name="PreStrategy_ArcLeft">
      <entry brief="turn_left">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ArcL~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ArcL~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../69">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="164,20,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="152,20,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="152,10,18,12">
       <entry box="1,2,16,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Turn180}-->
     <state name="PreStrategy_Turn180">
      <entry brief="turn_left_180">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 400);
imu_set_setpoint(180);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Turn~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Turn~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="366,19,4,2,96,-275,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="354,19,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="354,8,18,13">
       <entry box="1,2,15,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_1_sub1}-->
     <state name="PreStrategy_1_sub1">
      <entry brief="go_front">reset_imu_angle_z();
imu_set_setpoint(0);
imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(15, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_1_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../20">
       <tran_glyph conn="32,55,3,2,8,60,51,8">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_1_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="32,52,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="32,46,18,10">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ZigZagLeft}-->
     <state name="PreStrategy_ZigZagLeft">
      <entry brief="turn_left">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_setpoint(40);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ZigZ~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ZigZ~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../70">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="212,17,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="200,17,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="200,10,18,9">
       <entry box="1,2,15,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ZigZagRight}-->
     <state name="PreStrategy_ZigZagRight">
      <entry brief="turn_right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_setpoint(320);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ZigZ~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_ZigZ~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../74">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="236,17,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="224,17,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="224,10,18,9">
       <entry box="1,2,10,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_3_sub2}-->
     <state name="PreStrategy_3_sub2">
      <entry brief="turn_right_break">imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_3_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_3_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="92,58,5,2,1,57,-2,8">
         <action box="-11,3,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="80,58,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="80,46,18,14">
       <entry box="1,2,16,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_DefenseLeft}-->
     <state name="PreStrategy_DefenseLeft">
      <entry brief="align">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 2000);

bool seeing;
seeing = SumoHSM_CheckDistAndMoveDefense(me);

if (distance_is_active(DIST_SENSOR_F)){
    if (parameters.pre_strategy == 10){
         drive(-100,100);
    } else {
        drive(100,-100);
    }
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 5);
}

if (distance_is_active(DIST_SENSOR_FR) &amp;&amp; distance_is_active(DIST_SENSOR_FL)){
    me-&gt;step_counter++;
    if (me-&gt;step_counter &gt; 6){
        QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 10);
    }
}

if (seeing) {
    QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
} else {
    drive(0,0);
    uint32_t small_step_wait = 1300 * BSP_TICKS_PER_MILISSEC;
    QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, small_step_wait);
}</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);</exit>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Defe~::DIST_SENSOR_CHANGE}-->
      <tran trig="DIST_SENSOR_CHANGE" target="..">
       <tran_glyph conn="266,15,1,0,7,-7,-9,2">
        <action box="-3,-9,19,3"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Defe~::TIMEOUT_2}-->
      <tran trig="TIMEOUT_2" target="../../42">
       <tran_glyph conn="248,19,3,3,-2,7,2">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Defe~::TIMEOUT}-->
      <tran trig="TIMEOUT">
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Defe~::TIMEOUT::[ps==10]}-->
       <choice target="../../../43">
        <guard brief="ps == 10">parameters.pre_strategy == 10</guard>
        <choice_glyph conn="271,35,5,1,-2,8,-3">
         <action box="-5,8,6,3"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Defe~::TIMEOUT::[else]}-->
       <choice target="../../../47">
        <guard brief="else">else</guard>
        <choice_glyph conn="271,35,5,0,8,3">
         <action box="3,-3,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="266,18,1,-1,5,17">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="248,10,18,10">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_sub1}-->
     <state name="PreStrategy_10_sub1">
      <entry brief="step_advance">drive(100,100);
uint32_t small_step_advance_time = 15 * BSP_TICKS_PER_MILISSEC;
QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, small_step_advance_time);</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);</exit>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::TIMEOUT_2, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT_2, DIST_SENSOR_CHANGE" target="../../41">
       <tran_glyph conn="248,32,3,3,-3,-18,3">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="248,24,18,11">
       <entry box="1,2,14,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_sub2}-->
     <state name="PreStrategy_10_sub2">
      <entry brief="left">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
reset_imu_angle_z();
imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../78">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="260,46,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="248,46,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="248,38,18,10">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Back}-->
     <state name="PreStrategy_Back">
      <entry brief="motor_back">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_base_speed(-35);
imu_set_setpoint(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Back::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
      <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR" target="../../45">
       <tran_glyph conn="330,14,3,0,14,8">
        <action box="0,-2,19,4"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Back::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="330,18,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="330,8,18,12">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_13_sub1}-->
     <state name="PreStrategy_13_sub1">
      <entry brief="go_front">reset_imu_angle_z();
imu_set_base_speed(100);
imu_set_setpoint(0);

uint16_t move_time_ms = get_time_to_move_ms(20, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_13_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../20">
       <tran_glyph conn="330,28,3,2,-3,87,-236,8">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_13_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="330,31,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="330,22,18,11">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_OmaeRight}-->
     <state name="PreStrategy_OmaeRight">
      <entry brief="turn_right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_setpoint(305);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Omae~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Omae~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../62">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="140,17,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="128,17,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="128,10,18,9">
       <entry box="1,2,13,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_sub2}-->
     <state name="PreStrategy_11_sub2">
      <entry brief="right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
reset_imu_angle_z();
imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../80">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="284,46,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="272,46,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="272,38,18,10">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Deceive}-->
     <state name="PreStrategy_Deceive">
      <entry brief="go_front">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
imu_set_base_speed(100);
imu_set_setpoint(0);

uint16_t move_time_ms = get_time_to_move_ms(80, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Dece~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../49">
       <tran_glyph conn="296,17,3,0,11,3">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Dece~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="296,14,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="296,8,18,10">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_sub1}-->
     <state name="PreStrategy_12_sub1">
      <entry brief="go_back">imu_set_base_speed(-100);
imu_set_setpoint(0);

uint16_t move_time_ms = get_time_to_move_ms(100, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../50">
       <tran_glyph conn="296,29,3,0,10,4">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
      <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR" target="../../45">
       <tran_glyph conn="314,24,1,3,14,2,2">
        <action box="0,-2,12,4"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="296,26,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="296,20,18,10">
       <entry box="1,2,11,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_sub2}-->
     <state name="PreStrategy_12_sub2">
      <entry brief="break_front">imu_set_base_speed(100);
imu_set_setpoint(0);

uint16_t move_time_ms = get_time_to_move_ms(15, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::TIMEOUT}-->
      <tran trig="TIMEOUT">
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::TIMEOUT::[ps==12]}-->
       <choice target="../../../43">
        <guard brief="ps == 12">parameters.pre_strategy == 12</guard>
        <choice_glyph conn="291,28,5,1,-23,13,-2">
         <action box="-19,-3,8,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::TIMEOUT::[else]}-->
       <choice target="../../../47">
        <guard brief="else">else</guard>
        <choice_glyph conn="291,28,5,0,-8,10">
         <action box="-7,1,5,3"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="296,39,3,-1,-5,-11">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_12_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="296,41,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="296,33,18,10">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Deceive2}-->
     <state name="PreStrategy_Deceive2">
      <entry brief="turn_left">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 2000);
imu_set_setpoint(40);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Dece~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Dece~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../82">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="390,14,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="378,14,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="378,8,18,8">
       <entry box="1,2,15,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Attack}-->
     <state name="PreStrategy_Attack">
      <entry brief="front">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 300);
imu_set_base_speed(100);
imu_set_setpoint(0);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Atta~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../20">
       <tran_glyph conn="400,19,3,2,-1,96,-308,8">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Atta~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="400,15,3,-1,11">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="400,8,18,12">
       <entry box="1,2,15,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_WaitDraw}-->
     <state name="PreStrategy_WaitDraw">
      <entry brief="align">QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
bool seeing;
seeing = SumoHSM_CheckDistAndMoveDefense(me);

if (distance_is_active(DIST_SENSOR_F)){
    drive(-100,100);
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 5);
}


if (seeing) {
    QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
} else {
    drive(0,0);
    uint32_t small_step_wait = 1500 * BSP_TICKS_PER_MILISSEC;
    QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, small_step_wait);
}</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);</exit>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Wait~::DIST_SENSOR_CHANGE}-->
      <tran trig="DIST_SENSOR_CHANGE" target="..">
       <tran_glyph conn="442,13,1,0,7,-7,-9,2">
        <action box="-3,-9,19,3"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Wait~::TIMEOUT_2}-->
      <tran trig="TIMEOUT_2" target="../../54">
       <tran_glyph conn="424,17,3,3,-2,9,2">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Wait~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../55">
       <tran_glyph conn="442,16,1,1,4,25,-4">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="424,8,18,10">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_sub1}-->
     <state name="PreStrategy_18_sub1">
      <entry brief="step_advance">me-&gt;step_counter++;
if (me-&gt;step_counter &lt; 8){
    drive(100,100);
} else {
    drive(-100,-100);
    if (me-&gt;step_counter &gt; 12){
        me-&gt;step_counter = 0;
    }
}

uint32_t small_step_advance_time = 15 * BSP_TICKS_PER_MILISSEC;
QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, small_step_advance_time);</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);</exit>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_s~::TIMEOUT_2, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT_2, DIST_SENSOR_CHANGE" target="../../53">
       <tran_glyph conn="424,30,3,3,-3,-16,3">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="424,22,18,11">
       <entry box="1,2,14,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_sub2}-->
     <state name="PreStrategy_18_sub2">
      <entry brief="turn_right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
reset_imu_angle_z();
imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../56">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="436,45,4,0,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="424,45,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="424,36,18,11">
       <entry box="1,2,12,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_sub3}-->
     <state name="PreStrategy_18_sub3">
      <entry brief="go_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../20">
       <tran_glyph conn="424,59,3,2,-20,56,-313,8">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_18_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="424,63,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="424,53,18,12">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_CustomRight}-->
     <state name="PreStrategy_CustomRight">
      <entry brief="turn_right">QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * 1000);
reset_imu_angle_z();
imu_set_setpoint(270);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Cust~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_Cust~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../87">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="468,16,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="456,16,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="456,8,18,10">
       <entry box="1,2,15,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_sub1}-->
     <state name="PreStrategy_4_sub1">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="104,30,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../59">
       <tran_glyph conn="104,32,3,0,12,4">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="104,23,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_sub2}-->
     <state name="PreStrategy_4_sub2">
      <entry brief="turn_right">imu_set_setpoint(0);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../60">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="116,43,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="104,43,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="104,36,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_sub3}-->
     <state name="PreStrategy_4_sub3">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="104,55,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../61">
       <tran_glyph conn="104,57,3,0,12,4">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="104,48,18,10">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_sub4}-->
     <state name="PreStrategy_4_sub4">
      <entry brief="turn_right">imu_set_setpoint(270);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_4_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="116,68,4,2,47,-25,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="104,68,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="104,61,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_sub1}-->
     <state name="PreStrategy_5_sub1">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="128,30,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../63">
       <tran_glyph conn="128,32,3,0,12,4">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="128,23,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_sub2}-->
     <state name="PreStrategy_5_sub2">
      <entry brief="turn_left">imu_set_setpoint(0);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../64">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="140,43,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="128,43,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="128,36,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_sub3}-->
     <state name="PreStrategy_5_sub3">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="128,55,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../65">
       <tran_glyph conn="128,57,3,0,12,3">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="128,48,18,10">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_sub4}-->
     <state name="PreStrategy_5_sub4">
      <entry brief="turn_left">imu_set_setpoint(90);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_5_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="140,67,4,2,48,-49,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="128,67,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="128,60,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_6_sub2}-->
     <state name="PreStrategy_6_sub2">
      <entry brief="arc_right">imu_set_setpoint(315);
imu_set_base_speed(65);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_6_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_6_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="164,51,4,2,64,-73,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="152,51,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="152,44,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_7_sub1}-->
     <state name="PreStrategy_7_sub1">
      <entry brief="motor_front">imu_set_setpoint(315);
imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(55, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_7_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="176,34,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_7_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../68">
       <tran_glyph conn="176,38,3,0,12,6">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="176,26,18,14">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_7_sub2}-->
     <state name="PreStrategy_7_sub2">
      <entry brief="arc_left">imu_set_setpoint(45);
imu_set_base_speed(65);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_7_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_7_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="188,51,4,2,64,-97,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="176,51,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="176,44,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_6_sub1}-->
     <state name="PreStrategy_6_sub1">
      <entry brief="motor_front">imu_set_setpoint(45);
imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(55, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_6_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="152,34,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_6_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../66">
       <tran_glyph conn="152,38,3,0,12,6">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="152,26,18,14">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_sub1}-->
     <state name="PreStrategy_8_sub1">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="200,29,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../71">
       <tran_glyph conn="200,31,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="200,22,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_sub2}-->
     <state name="PreStrategy_8_sub2">
      <entry brief="turn_right">imu_set_setpoint(270);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../72">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="212,43,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="200,43,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="200,36,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_sub3}-->
     <state name="PreStrategy_8_sub3">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(90, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="200,55,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../73">
       <tran_glyph conn="200,57,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="200,48,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_sub4}-->
     <state name="PreStrategy_8_sub4">
      <entry brief="turn_left">imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_8_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="212,69,4,2,46,-121,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="200,69,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="200,62,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_sub1}-->
     <state name="PreStrategy_9_sub1">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="224,29,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../75">
       <tran_glyph conn="224,31,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="224,22,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_sub2}-->
     <state name="PreStrategy_9_sub2">
      <entry brief="turn_right">imu_set_setpoint(90);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../76">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="236,43,4,0,5">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="224,43,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="224,36,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_sub3}-->
     <state name="PreStrategy_9_sub3">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(90, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="224,55,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../77">
       <tran_glyph conn="224,57,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="224,48,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_sub4}-->
     <state name="PreStrategy_9_sub4">
      <entry brief="turn_left">imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_9_su~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="236,69,4,2,46,-145,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="224,69,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="224,62,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_sub3}-->
     <state name="PreStrategy_10_sub3">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="248,58,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../79">
       <tran_glyph conn="248,60,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="248,51,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_sub4}-->
     <state name="PreStrategy_10_sub4">
      <entry brief="turn_right">imu_set_setpoint(270);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_10_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="260,72,4,2,43,-169,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="248,72,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="248,65,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_sub3}-->
     <state name="PreStrategy_11_sub3">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="272,58,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../81">
       <tran_glyph conn="272,60,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="272,51,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_sub4}-->
     <state name="PreStrategy_11_sub4">
      <entry brief="turn_right">imu_set_setpoint(90);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_11_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="284,72,4,2,43,-193,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="272,72,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="272,65,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_sub1}-->
     <state name="PreStrategy_16_sub1">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="378,27,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../83">
       <tran_glyph conn="378,29,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="378,20,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_sub2}-->
     <state name="PreStrategy_16_sub2">
      <entry brief="motor_back">imu_set_base_speed(-100);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
      <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR" target="../../45">
       <tran_glyph conn="378,40,3,1,-28,-12,-2">
        <action box="0,-2,19,4"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="378,44,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../84">
       <tran_glyph conn="378,48,3,0,13,6">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="378,34,18,16">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_sub3}-->
     <state name="PreStrategy_16_sub3">
      <entry brief="turn_right">imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../85">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="390,61,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="378,61,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="378,54,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_sub4}-->
     <state name="PreStrategy_16_sub4">
      <entry brief="motor_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="378,74,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../86">
       <tran_glyph conn="378,76,3,0,12,5">
        <action box="0,-2,19,6"/>
       </tran_glyph>
      </tran>
      <state_glyph node="378,67,18,11">
       <entry box="1,2,12,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_sub5}-->
     <state name="PreStrategy_16_sub5">
      <entry brief="turn_left">imu_set_setpoint(45);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_16_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="390,88,4,2,27,-299,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="378,88,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="378,81,18,9">
       <entry box="1,2,14,3"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_sub1}-->
     <state name="PreStrategy_19_sub1">
      <entry brief="go_back">imu_set_base_speed(-100);

uint16_t move_time_ms = get_time_to_move_ms(30, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="456,34,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../88">
       <tran_glyph conn="456,28,3,0,15,10">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
      <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR" target="../../91">
       <tran_glyph conn="456,30,3,1,-2,43,-1">
        <action box="0,-2,19,4"/>
       </tran_glyph>
      </tran>
      <state_glyph node="456,22,18,13">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_sub2}-->
     <state name="PreStrategy_19_sub2">
      <entry brief="turn_left">imu_set_setpoint(0);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../../89">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="468,47,4,0,6">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="456,47,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="456,38,18,11">
       <entry box="1,2,12,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_sub3}-->
     <state name="PreStrategy_19_sub3">
      <entry brief="go_front">imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(50, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="456,63,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../90">
       <tran_glyph conn="456,59,3,0,15,10">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="456,53,18,12">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_sub4}-->
     <state name="PreStrategy_19_sub4">
      <entry brief="turn_right">imu_set_setpoint(315);
imu_set_base_speed(0);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED::[near_set_point]}-->
       <choice target="../../.." cpref="../../../20">
        <guard brief="near_set_point">near_set_point() == true</guard>
        <choice_glyph conn="468,78,4,2,37,-377,8">
         <action box="-12,2,12,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="456,78,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="456,69,18,11">
       <entry box="1,2,12,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_sub5}-->
     <state name="PreStrategy_19_sub5">
      <entry brief="go_front">reset_imu_angle_z();
imu_set_setpoint(0);
imu_set_base_speed(100);

uint16_t move_time_ms = get_time_to_move_ms(15, 100, &amp;parameters);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../20">
       <tran_glyph conn="435,78,3,2,8,37,-352,8">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::PreStrategy::PreStrategy_19_s~::IMU_UPDATED}-->
      <tran trig="IMU_UPDATED">
       <action>int8_t l_speed = 0;
int8_t r_speed = 0;

int8_t ret = imu_pid_process(&amp;l_speed, &amp;r_speed);

if (ret == 0){
    drive(l_speed, r_speed);
}</action>
       <tran_glyph conn="435,75,3,-1,12">
        <action box="0,-2,13,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="435,69,18,10">
       <entry box="1,2,13,2"/>
      </state_glyph>
     </state>
     <submachine_diagram size="501,122">
      <entry box="1,2,22,4"/>
      <exit box="1,6,6,2"/>
     </submachine_diagram>
    </submachine>
    <!--${AOs::SumoHSM::SM::BLESubmachine}-->
    <submachine name="BLESubmachine">
     <entry brief="Prepare Timers">QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;timeEvtBle);

me-&gt;ble_counter = 0;
QTimeEvt_armX(&amp;me-&gt;timeEvtBle, BSP_TICKS_PER_MILISSEC * 10, 0);</entry>
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;timeEvtBle);</exit>
     <!--${AOs::SumoHSM::SM::BLESubmachine::XP-XP1}-->
     <xp name="XP1">
      <xp_glyph point="60,20,1">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::BLESubmachine::TIMEOUT_SEND_BLE}-->
     <tran trig="TIMEOUT_SEND_BLE">
      <action brief="report_params()">if (me-&gt;ble_counter &lt; (BLE_TRANSMIT_NUM_OF_PACKETS - 1)){
    parameters_report(parameters, me-&gt;ble_counter);
    QTimeEvt_armX(&amp;me-&gt;timeEvtBle, BSP_TICKS_PER_MILISSEC * 60, 0);
    me-&gt;ble_counter++;
} else {
    parameters_report(parameters, (BLE_TRANSMIT_NUM_OF_PACKETS - 1));
    QTimeEvt_armX(&amp;me-&gt;timeEvt_2, BSP_TICKS_PER_MILISSEC * 60, 0);
}

</action>
      <tran_glyph conn="2,15,3,-1,23">
       <action box="0,-2,26,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::BLESubmachine::TIMEOUT_2}-->
     <tran trig="TIMEOUT_2" target=".." cpref="../0">
      <tran_glyph conn="2,20,3,1,57">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <submachine_diagram size="58,45">
      <entry box="1,2,27,3"/>
      <exit box="1,5,6,2"/>
     </submachine_diagram>
    </submachine>
    <!--${AOs::SumoHSM::SM::StarStrategy}-->
    <submachine name="StarStrategy">
     <entry brief="PlayBuzzer">buzzer_start();
QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 100);
me-&gt;stuck_counter = 0;
led_stripe_set_all_color(COLOR_ORANGE);</entry>
     <exit brief="DisableTimers">QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
QTimeEvt_disarm(&amp;me-&gt;timeEvtStuckEnd);
QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;buzzerStopTimer);
buzzer_stop();</exit>
     <!--${AOs::SumoHSM::SM::StarStrategy::XP-STOP_XP}-->
     <xp name="STOP_XP">
      <xp_glyph point="2,67,3">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::StarStrategy::XP-LINE_FRONT}-->
     <xp name="LINE_FRONT">
      <xp_glyph point="49,73,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::StarStrategy::XP-LINE_BACK}-->
     <xp name="LINE_BACK">
      <xp_glyph point="112,73,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::StarStrategy::initial}-->
     <initial target="../8">
      <initial_glyph conn="74,9,5,0,-8,13">
       <action box="0,-2,10,2"/>
      </initial_glyph>
     </initial>
     <!--${AOs::SumoHSM::SM::StarStrategy::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR">
      <!--${AOs::SumoHSM::SM::StarStrategy::LINE_CHANGED_FL,~::[white]}-->
      <choice target="../.." cpref="../../1">
       <guard brief="white">adc_line_is_white(LINE_FL) || adc_line_is_white(LINE_FR)</guard>
       <choice_glyph conn="28,52,5,2,3,18,18,2">
        <action box="2,-3,7,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="2,52,3,-1,26">
       <action box="0,-2,21,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StarStrategy::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop()">buzzer_stop();</action>
      <tran_glyph conn="2,16,3,-1,22">
       <action box="0,-2,23,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StarStrategy::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR">
      <!--${AOs::SumoHSM::SM::StarStrategy::LINE_CHANGED_BL,~::[white]}-->
      <choice target="../.." cpref="../../2">
       <guard brief="white">adc_line_is_white(LINE_BL) || adc_line_is_white(LINE_BR)</guard>
       <choice_glyph conn="29,47,5,2,8,21,75,4">
        <action box="2,-3,10,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="2,47,3,-1,27">
       <action box="0,-5,17,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StarStrategy::STOP, CHANGE_STATE_EVT}-->
     <tran trig="STOP, CHANGE_STATE_EVT" target=".." cpref="../0">
      <tran_glyph conn="2,63,3,3,5,4,-4">
       <action box="0,-2,27,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StarStrategy::StarFullSpeed}-->
     <state name="StarFullSpeed">
      <entry brief="CheckSensors and Move">bool seeing = SumoHSM_CheckDistAndMove(me);
if (seeing) {
    QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * parameters.is_stucked_timeout_ms);
} else {
    drive(100, 100);
    QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * parameters.star_full_speed_time_ms);
}
</entry>
      <exit brief="Disable timer stuck">QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
      <!--${AOs::SumoHSM::SM::StarStrategy::StarFullSpeed::DIST_SENSOR_CHANGE, TIMEOUT}-->
      <tran trig="DIST_SENSOR_CHANGE, TIMEOUT" target="../../10">
       <tran_glyph conn="56,34,3,3,-8,15,28">
        <action box="-7,4,20,4"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::StarStrategy::StarFullSpeed::STUCK, IMU_INCLINATION}-->
      <tran trig="STUCK, IMU_INCLINATION" target="../../9">
       <tran_glyph conn="81,29,1,3,18">
        <action box="1,-2,14,4"/>
       </tran_glyph>
      </tran>
      <state_glyph node="56,22,25,15">
       <entry box="1,2,24,5"/>
       <exit box="1,7,22,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StarStrategy::Stuck}-->
     <state name="Stuck">
      <entry>uint16_t move_time_ms;

if (me-&gt;stuck_counter &gt;= 1){
    drive(-100,-40);
    move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
} else {
    drive(-100,-100);
    move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
}

me-&gt;stuck_counter++;
QTimeEvt_rearm(&amp;me-&gt;timeEvtStuckEnd, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuckEnd);</exit>
      <!--${AOs::SumoHSM::SM::StarStrategy::Stuck::STUCK_END}-->
      <tran trig="STUCK_END">
       <!--${AOs::SumoHSM::SM::StarStrategy::Stuck::STUCK_END::[stuck<=1]}-->
       <choice target="../../../10">
        <guard brief="stuck &lt;= 1">me-&gt;stuck_counter &lt;= 1 &amp;&amp; !get_imu_inclination_stat()</guard>
        <choice_glyph conn="120,53,5,1,-19">
         <action box="-16,0,12,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::StarStrategy::Stuck::STUCK_END::[else]}-->
       <choice target="../../../11">
        <guard brief="else">else</guard>
        <choice_glyph conn="120,53,5,3,12">
         <action box="1,0,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::StarStrategy::Stuck::STUCK_END::[inclination_true]}-->
       <choice target="../..">
        <guard brief="inclination_true">get_imu_inclination_stat()</guard>
        <choice_glyph conn="120,53,5,1,7,-21,-3">
         <action box="5,-24,15,3"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="120,37,2,-1,16">
        <action box="-8,-3,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="99,22,25,15">
       <entry box="1,2,7,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StarStrategy::SearchAndAttack}-->
     <state name="SearchAndAttack">
      <entry brief="CheckSensors and Move">bool seeing = SumoHSM_CheckDistAndMove(me);
if (seeing) {
    QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * parameters.is_stucked_timeout_ms);
} else {
    drive(parameters.star_speed, parameters.star_speed);
    QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
}
</entry>
      <exit brief="Disable timer stuck">QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
      <!--${AOs::SumoHSM::SM::StarStrategy::SearchAndAttack::DIST_SENSOR_CHANGE}-->
      <tran trig="DIST_SENSOR_CHANGE" target="..">
       <tran_glyph conn="76,54,3,2,-11,6,22,-3">
        <action box="-19,-3,21,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::StarStrategy::SearchAndAttack::STUCK, IMU_INCLINATION}-->
      <tran trig="STUCK, IMU_INCLINATION" target="../../9">
       <tran_glyph conn="101,49,1,2,11,-12">
        <action box="1,-2,14,4"/>
       </tran_glyph>
      </tran>
      <state_glyph node="76,42,25,15">
       <entry box="1,2,24,5"/>
       <exit box="1,7,22,4"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StarStrategy::StuckTurn}-->
     <state name="StuckTurn">
      <entry>uint16_t turn_time_ms;

drive(-100,100);
turn_time_ms = get_time_to_turn_ms(60, 100, SIDE_LEFT, &amp;parameters);
me-&gt;stuck_counter = 0;

QTimeEvt_rearm(&amp;me-&gt;timeEvtStuckEnd, BSP_TICKS_PER_MILISSEC * turn_time_ms);</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuckEnd);</exit>
      <!--${AOs::SumoHSM::SM::StarStrategy::StuckTurn::STUCK_END}-->
      <tran trig="STUCK_END" target="../../10">
       <tran_glyph conn="132,56,3,1,-31">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="132,41,21,16">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <submachine_diagram size="188,71">
      <entry box="1,2,21,3"/>
      <exit box="1,5,19,2"/>
     </submachine_diagram>
    </submachine>
    <!--${AOs::SumoHSM::SM::LineBackSubmachine}-->
    <submachine name="LineBackSubmachine">
     <exit brief="disarm_timer">QTimeEvt_disarm(&amp;me-&gt;timeEvt);</exit>
     <!--${AOs::SumoHSM::SM::LineBackSubmachi~::XP-XP1}-->
     <xp name="XP1">
      <xp_glyph point="45,2,0">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::LineBackSubmachi~::XP-STOP_XP}-->
     <xp name="STOP_XP">
      <xp_glyph point="43,69,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::LineBackSubmachi~::initial}-->
     <initial target="../4">
      <initial_glyph conn="23,12,5,0,-4,4">
       <action box="0,-2,10,2"/>
      </initial_glyph>
     </initial>
     <!--${AOs::SumoHSM::SM::LineBackSubmachi~::STOP, CHANGE_STATE_EVT}-->
     <tran trig="STOP, CHANGE_STATE_EVT" target=".." cpref="../1">
      <tran_glyph conn="2,64,3,2,41,4">
       <action box="0,-2,29,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state1}-->
     <state name="LineBack_state1">
      <entry brief="go_front">uint32_t movement_time_ms;
if (!adc_line_is_white(LINE_FL) &amp;&amp; !adc_line_is_white(LINE_FR)){
    drive(100, 100);
    movement_time_ms = BSP_TICKS_PER_MILISSEC * 80;
} else if (adc_line_is_white(LINE_FL)){
    drive(100, -100);
    movement_time_ms = BSP_TICKS_PER_MILISSEC * 50;
} else {
    drive(-100, 100);
    movement_time_ms = BSP_TICKS_PER_MILISSEC * 50;
}

led_stripe_set_all_color(COLOR_BLUE);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, movement_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state1::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../5">
       <tran_glyph conn="7,23,3,0,31,11">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state1::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
      <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR" target="../../5">
       <tran_glyph conn="7,26,3,0,18,8">
        <action box="0,-2,35,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="7,16,34,13">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state2}-->
     <state name="LineBack_state2">
      <entry>uint32_t movement_time_ms;
if (!adc_line_is_white(LINE_FL) &amp;&amp; !adc_line_is_white(LINE_FR)){
     if (adc_line_is_white(LINE_BL) || adc_line_is_white(LINE_BR)) {
         drive(100, 100);
     } else {
         drive(0, 0);
     }
} else if (adc_line_is_white(LINE_FL)) {
    drive(100, -100);
} else if (adc_line_is_white(LINE_FR)) {
    drive(-100, 100);
} else {
    drive(20, 20);
}

movement_time_ms = BSP_TICKS_PER_MILISSEC * 10;
QTimeEvt_rearm(&amp;me-&gt;timeEvt, movement_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state2::TIMEOUT}-->
      <tran trig="TIMEOUT">
       <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state2::TIMEOUT::[white]}-->
       <choice target="../..">
        <guard brief="white">(adc_line_get_all() != 0)</guard>
        <choice_glyph conn="57,40,5,1,-15">
         <action box="-13,-3,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::LineBackSubmachi~::LineBack_state2::TIMEOUT::[else]}-->
       <choice target="../../.." cpref="../../../0">
        <guard>else</guard>
        <choice_glyph conn="57,40,4,0,-19,-12,-18">
         <action box="-10,-22,10,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="7,44,3,-1,50,-4">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="7,34,35,13">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <submachine_diagram size="70,67">
      <exit box="1,2,19,3"/>
     </submachine_diagram>
    </submachine>
    <!--${AOs::SumoHSM::SM::StepsStrategy}-->
    <submachine name="StepsStrategy">
     <entry brief="play_buzzer">buzzer_start();
QTimeEvt_rearm(&amp;me-&gt;buzzerStopTimer, BSP_TICKS_PER_MILISSEC * 100);
me-&gt;stuck_counter = 0;
led_stripe_set_all_color(COLOR_ORANGE);
me-&gt;step_counter = 0;</entry>
     <exit brief="disarm_timers">QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);
QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
QTimeEvt_disarm(&amp;me-&gt;timeEvtStuckEnd);
QTimeEvt_disarm(&amp;me-&gt;buzzerStopTimer);
buzzer_stop();</exit>
     <!--${AOs::SumoHSM::SM::StepsStrategy::XP-LINE_BACK}-->
     <xp name="LINE_BACK">
      <xp_glyph point="81,57,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::StepsStrategy::XP-LINE_FRONT}-->
     <xp name="LINE_FRONT">
      <xp_glyph point="33,57,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::StepsStrategy::XP-STOP_XP}-->
     <xp name="STOP_XP">
      <xp_glyph point="2,49,3">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::StepsStrategy::initial}-->
     <initial target="../8">
      <initial_glyph conn="39,7,5,0,11,4">
       <action box="0,-2,10,2"/>
      </initial_glyph>
     </initial>
     <!--${AOs::SumoHSM::SM::StepsStrategy::STOP_BUZZER}-->
     <tran trig="STOP_BUZZER">
      <action brief="buzzer_stop()">buzzer_stop();</action>
      <tran_glyph conn="2,15,3,-1,15">
       <action box="0,-2,22,3"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StepsStrategy::LINE_CHANGED_BL, LINE_CHANGED_BR}-->
     <tran trig="LINE_CHANGED_BL, LINE_CHANGED_BR">
      <!--${AOs::SumoHSM::SM::StepsStrategy::LINE_CHANGED_BL,~::[white]}-->
      <choice target="../.." cpref="../../0">
       <guard brief="white">adc_line_is_white(LINE_BL) || adc_line_is_white(LINE_BR)</guard>
       <choice_glyph conn="20,26,5,2,7,24,54,6">
        <action box="-2,-4,6,3"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="2,26,3,-1,18">
       <action box="0,-2,16,4"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StepsStrategy::LINE_CHANGED_FL, LINE_CHANGED_FR}-->
     <tran trig="LINE_CHANGED_FL, LINE_CHANGED_FR">
      <!--${AOs::SumoHSM::SM::StepsStrategy::LINE_CHANGED_FL,~::[white]}-->
      <choice target="../.." cpref="../../1">
       <guard brief="white">adc_line_is_white(LINE_FL) || adc_line_is_white(LINE_FR)</guard>
       <choice_glyph conn="21,38,5,2,3,15,9,3">
        <action box="-3,-4,6,2"/>
       </choice_glyph>
      </choice>
      <tran_glyph conn="2,38,3,-1,19">
       <action box="0,-2,18,5"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StepsStrategy::STOP, CHANGE_STATE_EVT}-->
     <tran trig="STOP, CHANGE_STATE_EVT" target=".." cpref="../2">
      <tran_glyph conn="2,43,3,3,9,6,-8">
       <action box="0,-2,26,3"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::StepsStrategy::SearchAndAttack}-->
     <state name="SearchAndAttack">
      <entry>bool seeing;
if (parameters.strategy == 1){
    seeing = SumoHSM_CheckDistAndMove(me);
} else {
    seeing = SumoHSM_CheckDistAndMoveDefense(me);
}


if (seeing) {
    QTimeEvt_disarm(&amp;me-&gt;timeEvt);
    QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * parameters.is_stucked_timeout_ms);
} else {
    drive(0,0);
    QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
    uint32_t small_step_wait = parameters.step_wait_time_ms * BSP_TICKS_PER_MILISSEC;
    QTimeEvt_rearm(&amp;me-&gt;timeEvt, small_step_wait);
}
</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
      <!--${AOs::SumoHSM::SM::StepsStrategy::SearchAndAttack::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../9">
       <tran_glyph conn="42,22,3,0,11,9">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::StepsStrategy::SearchAndAttack::STUCK, IMU_INCLINATION}-->
      <tran trig="STUCK, IMU_INCLINATION" target="../../10">
       <tran_glyph conn="66,16,1,3,25">
        <action box="0,-5,18,5"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::StepsStrategy::SearchAndAttack::DIST_SENSOR_CHANGE}-->
      <tran trig="DIST_SENSOR_CHANGE" target="..">
       <tran_glyph conn="66,24,1,1,20,-6,-20">
        <action box="0,-2,19,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="42,11,24,14">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StepsStrategy::StepAdvance}-->
     <state name="StepAdvance">
      <entry>uint32_t small_step_advance_time;
if (parameters.strategy  == 2) {

    if (me-&gt;step_counter % 2 == 0){
        drive(100,100);
    } else {
        drive(-100,-100);
    }
    small_step_advance_time = 12 * BSP_TICKS_PER_MILISSEC;
    me-&gt;step_counter++;
} else {
    drive(100,100);
    small_step_advance_time = parameters.step_advance_time_ms * BSP_TICKS_PER_MILISSEC;
}
QTimeEvt_rearm(&amp;me-&gt;timeEvt_2, small_step_advance_time);</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt_2);</exit>
      <!--${AOs::SumoHSM::SM::StepsStrategy::StepAdvance::TIMEOUT_2, DIST_SENSOR_CHANGE}-->
      <tran trig="TIMEOUT_2, DIST_SENSOR_CHANGE" target="../../8">
       <tran_glyph conn="42,40,3,3,-5,-23,5">
        <action box="0,-2,24,5"/>
       </tran_glyph>
      </tran>
      <state_glyph node="42,31,23,13">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StepsStrategy::Stuck}-->
     <state name="Stuck">
      <entry>uint16_t move_time_ms;

if (me-&gt;stuck_counter &gt;= 1){
    drive(-100,-40);
    move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
} else {
    drive(-100,-100);
    move_time_ms = get_time_to_move_ms(60, 100, &amp;parameters);
}

me-&gt;stuck_counter++;
QTimeEvt_rearm(&amp;me-&gt;timeEvtStuckEnd, BSP_TICKS_PER_MILISSEC * move_time_ms);</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuckEnd);</exit>
      <!--${AOs::SumoHSM::SM::StepsStrategy::Stuck::STUCK_END}-->
      <tran trig="STUCK_END">
       <!--${AOs::SumoHSM::SM::StepsStrategy::Stuck::STUCK_END::[stuck<=1]}-->
       <choice target="../../../11">
        <guard brief="stuck &lt;= 1">me-&gt;stuck_counter &lt;= 1 &amp;&amp; !get_imu_inclination_stat()</guard>
        <choice_glyph conn="122,26,4,1,10,-7">
         <action box="-9,0,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::StepsStrategy::Stuck::STUCK_END::[else]}-->
       <choice target="../../../12">
        <guard brief="else">else</guard>
        <choice_glyph conn="122,26,4,3,10,6">
         <action box="1,0,10,2"/>
        </choice_glyph>
       </choice>
       <!--${AOs::SumoHSM::SM::StepsStrategy::Stuck::STUCK_END::[inclination_true]}-->
       <choice target="../..">
        <guard brief="inclination_true">get_imu_inclination_stat()</guard>
        <choice_glyph conn="122,26,5,1,3,-11,-11">
         <action box="-7,-14,14,2"/>
        </choice_glyph>
       </choice>
       <tran_glyph conn="114,21,1,-1,8,5">
        <action box="0,-3,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="91,11,23,14">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StepsStrategy::StarSearch}-->
     <state name="StarSearch">
      <entry>bool seeing;
if (parameters.strategy == 1){
    seeing = SumoHSM_CheckDistAndMove(me);
} else {
    seeing = SumoHSM_CheckDistAndMoveDefense(me);
}
if (seeing) {
    QTimeEvt_rearm(&amp;me-&gt;timeEvtStuck, BSP_TICKS_PER_MILISSEC * parameters.is_stucked_timeout_ms);
} else {
    drive(parameters.star_speed, parameters.star_speed);
    QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);
}
</entry>
      <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvtStuck);</exit>
      <!--${AOs::SumoHSM::SM::StepsStrategy::StarSearch::STUCK, IMU_INCLINATION}-->
      <tran trig="STUCK, IMU_INCLINATION" target="../../10">
       <tran_glyph conn="96,30,0,2,-5">
        <action box="-14,-5,17,6"/>
       </tran_glyph>
      </tran>
      <!--${AOs::SumoHSM::SM::StepsStrategy::StarSearch::DIST_SENSOR_CHANGE}-->
      <tran trig="DIST_SENSOR_CHANGE" target="..">
       <tran_glyph conn="90,37,3,3,-20,3,20">
        <action box="-20,1,19,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="90,30,25,14">
       <entry box="1,2,6,2"/>
       <exit box="1,4,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::StepsStrategy::StuckTurn}-->
     <state name="StuckTurn">
      <entry>uint16_t turn_time_ms;

drive(-100,100);
turn_time_ms = get_time_to_turn_ms(60, 100, SIDE_LEFT, &amp;parameters);
me-&gt;stuck_counter = 0;

QTimeEvt_rearm(&amp;me-&gt;timeEvtStuckEnd, BSP_TICKS_PER_MILISSEC * turn_time_ms);</entry>
      <!--${AOs::SumoHSM::SM::StepsStrategy::StuckTurn::STUCK_END}-->
      <tran trig="STUCK_END" target="../../11">
       <tran_glyph conn="128,42,3,1,-13">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="128,31,23,13">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <submachine_diagram size="155,55">
      <entry box="1,2,23,3"/>
      <exit box="1,5,19,2"/>
     </submachine_diagram>
    </submachine>
    <!--${AOs::SumoHSM::SM::TestStartModule}-->
    <submachine name="TestStartModule">
     <exit>QTimeEvt_disarm(&amp;me-&gt;timeEvt);
buzzer_stop();</exit>
     <!--${AOs::SumoHSM::SM::TestStartModule::EP-EP1}-->
     <epseg name="EP1" target="../4">
      <epseg_glyph conn="81,13,1,1,-29">
       <name box="1,-2,10,2"/>
       <action box="1,0,10,2"/>
      </epseg_glyph>
     </epseg>
     <!--${AOs::SumoHSM::SM::TestStartModule::XP-START}-->
     <xp name="START">
      <xp_glyph point="19,67,2">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::TestStartModule::XP-BLINK_END}-->
     <xp name="BLINK_END">
      <xp_glyph point="81,55,1">
       <name box="1,-2,10,2"/>
      </xp_glyph>
     </xp>
     <!--${AOs::SumoHSM::SM::TestStartModule::START}-->
     <tran trig="START" target=".." cpref="../1">
      <tran_glyph conn="2,47,3,2,17,19">
       <action box="0,-2,10,2"/>
      </tran_glyph>
     </tran>
     <!--${AOs::SumoHSM::SM::TestStartModule::led_black_1}-->
     <state name="led_black_1">
      <entry>buzzer_start();
led_stripe_set_all_color(COLOR_BLACK);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 100);</entry>
      <!--${AOs::SumoHSM::SM::TestStartModule::led_black_1::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../5">
       <tran_glyph conn="30,15,3,3,-2,8,2">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="30,8,22,9">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::TestStartModule::led_red}-->
     <state name="led_red">
      <entry>led_stripe_set_all_color(COLOR_RED);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 100);</entry>
      <!--${AOs::SumoHSM::SM::TestStartModule::led_red::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../6">
       <tran_glyph conn="30,25,3,3,-2,8,2">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="30,19,22,8">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::TestStartModule::led_black_2}-->
     <state name="led_black_2">
      <entry>buzzer_stop();
led_stripe_set_all_color(COLOR_BLACK);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 100);</entry>
      <!--${AOs::SumoHSM::SM::TestStartModule::led_black_2::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../7">
       <tran_glyph conn="30,35,3,3,-2,8,2">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="30,29,22,8">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::TestStartModule::led_blue}-->
     <state name="led_blue">
      <entry>led_stripe_set_all_color(COLOR_BLUE);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 100);</entry>
      <!--${AOs::SumoHSM::SM::TestStartModule::led_blue::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../../8">
       <tran_glyph conn="30,46,3,3,-2,7,2">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="30,39,22,8">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <!--${AOs::SumoHSM::SM::TestStartModule::led_black}-->
     <state name="led_black">
      <entry>led_stripe_set_all_color(COLOR_BLACK);
QTimeEvt_rearm(&amp;me-&gt;timeEvt, BSP_TICKS_PER_MILISSEC * 100);</entry>
      <!--${AOs::SumoHSM::SM::TestStartModule::led_black::TIMEOUT}-->
      <tran trig="TIMEOUT" target="../.." cpref="../../2">
       <tran_glyph conn="52,55,1,1,28">
        <action box="0,-2,10,2"/>
       </tran_glyph>
      </tran>
      <state_glyph node="30,50,22,8">
       <entry box="1,2,6,2"/>
      </state_glyph>
     </state>
     <submachine_diagram size="79,65">
      <exit box="1,2,4,2"/>
     </submachine_diagram>
    </submachine>
    <state_diagram size="548,259"/>
   </statechart>
  </class>
 </package>
 <!--${.}-->
 <directory name=".">
  <!--${.::src}-->
  <directory name="src">
   <!--${.::src::sumo_hsm.c}-->
   <file name="sumo_hsm.c">
    <text>#include &lt;math.h&gt;
#include &lt;stdlib.h&gt;
// #include &lt;stdio.h&gt;
#include &quot;qf_custom_defines.h&quot;
#include &quot;qpc.h&quot;    /* QP/C framework API */
#include &quot;bsp.h&quot;    /* Board Support Package interface */
#include &quot;led_service.h&quot;
#include &quot;driving_service.h&quot;
#include &quot;buzzer_service.h&quot;
#include &quot;radio_service.h&quot;
#include &quot;distance_service.h&quot;
#include &quot;adc_service.h&quot;
#include &quot;bsp_eeprom.h&quot;
#include &quot;ble_service.h&quot;
#include &quot;parameters.h&quot;
#include &quot;custom_strategy.h&quot;
#include &quot;start_module.h&quot;
#include &quot;utils.h&quot;
#include &quot;imu_service.h&quot;

#define CALIB_ANGLE_MULT    2.5

static sumo_parameters_t parameters;

/* ask QM to declare the Blinky class --------------------------------------*/
$declare${AOs::SumoHSM}


/* instantiate the Blinky active object ------------------------------------*/
static SumoHSM l_sumo_hsm;
QActive * const AO_SumoHSM = &amp;l_sumo_hsm.super.super;


// Needs to be called in the beggining of the program, so that we don't have problems accessing the eeprom
void sumo_parameters_init(){
    parameters_init(&amp;parameters);
}

/* ask QM to define the Blinky class ---------------------------------------*/
$define${AOs::SumoHSM_ctor}



$define${AOs::SumoHSM}

#ifdef Q_SPY
void sumoHSM_update_qs_dict(){

    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.timeEvt);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.buzzerStopTimer);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.buzzerCount);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.timeEvt_2);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.timeEvtBle);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.timerFailSafe);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.timeEvtStuck);
    QS_OBJ_DICTIONARY(&amp;l_sumo_hsm.timeEvtStuckEnd);


    for (int sig = Q_USER_SIG; sig &lt; MAX_SIG; sig++)
    {
        QS_SIG_DICTIONARY(sig,         (void *)0);
    }


}

#endif</text>
   </file>
  </directory>
  <!--${.::inc}-->
  <directory name="inc">
   <!--${.::inc::bsp.h}-->
   <file name="bsp.h">
    <text>#ifndef BSP_H
#define BSP_H

#include &quot;qpc.h&quot;
#include &quot;signals.h&quot;

/* a very simple Board Support Package (BSP) -------------------------------*/
enum { 
    BSP_TICKS_PER_SEC = 1000
}; /* number of clock ticks in a second */

typedef enum {
    SIMULATOR = 100, //QS_USER0 on qs.h file. only useful on Qspy config
} qs_user_names_t;


#define BSP_TICKS_PER_MILISSEC (BSP_TICKS_PER_SEC/1000.0)

void BSP_init(void);
uint32_t BSP_GetTick(void);

/* active object(s) used in this application -------------------------------*/
extern QActive * const AO_SumoHSM; /* opaque pointer to the SumoHSM AO */
extern QActive *const imu_service_AO;
$declare${AOs::SumoHSM_ctor}

void sumo_parameters_init(void);

#ifdef Q_SPY
void sumoHSM_update_qs_dict(void);
#endif

#endif /* BSP_H */</text>
   </file>
  </directory>
 </directory>
</model>
